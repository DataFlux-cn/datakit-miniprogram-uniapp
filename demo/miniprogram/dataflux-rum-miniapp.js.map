{"version":3,"sources":["webpack://@cloudcare/rum-miniapp/webpack/bootstrap","webpack://@cloudcare/rum-miniapp/webpack/runtime/define property getters","webpack://@cloudcare/rum-miniapp/webpack/runtime/hasOwnProperty shorthand","webpack://@cloudcare/rum-miniapp/webpack/runtime/make namespace object","webpack://@cloudcare/rum-miniapp/./src/helper/enums.js","webpack://@cloudcare/rum-miniapp/./src/helper/utils.js","webpack://@cloudcare/rum-miniapp/./src/boot/buildEnv.js","webpack://@cloudcare/rum-miniapp/./src/core/lifeCycle.js","webpack://@cloudcare/rum-miniapp/./src/core/configuration.js","webpack://@cloudcare/rum-miniapp/./src/core/errorTools.js","webpack://@cloudcare/rum-miniapp/./src/core/sdk.js","webpack://@cloudcare/rum-miniapp/./src/helper/tracekit.js","webpack://@cloudcare/rum-miniapp/./src/core/xhrProxy.js","webpack://@cloudcare/rum-miniapp/./src/core/observable.js","webpack://@cloudcare/rum-miniapp/./src/core/downloadProxy.js","webpack://@cloudcare/rum-miniapp/./src/core/errorCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/error/errorCollection.js","webpack://@cloudcare/rum-miniapp/./src/core/baseInfo.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/assembly.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/parentContexts.js","webpack://@cloudcare/rum-miniapp/./src/core/dataMap.js","webpack://@cloudcare/rum-miniapp/./src/core/transport.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/transport/batch.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/trackEventCounts.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/page/index.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/page/viewCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/resource/resourceUtils.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/requestCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/resource/resourceCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/app/index.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/app/appCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/trackPageActiveites.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/action/trackActions.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/action/actionCollection.js","webpack://@cloudcare/rum-miniapp/./src/boot/rum.js","webpack://@cloudcare/rum-miniapp/./src/boot/rum.entry.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/performanceCollection.js","webpack://@cloudcare/rum-miniapp/./src/rumEventsCollection/setDataCollection.js"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","ONE_MINUTE","CLIENT_ID_TOKEN","RumEventType","RequestType","ActionType","tap","longpress","longtap","MpHook","data","onLoad","onShow","onReady","onPullDownRefresh","onReachBottom","onShareAppMessage","onPageScroll","onResize","onTabItemTap","onHide","onUnload","ArrayProto","Array","ObjProto","slice","toString","nativeForEach","forEach","each","iterator","context","length","i","l","values","results","msToNs","duration","toFixed","isString","isNumber","test","String","toArray","iterable","isArray","areInOrder","numbers","arguments","UUID","placeholder","parseInt","Math","random","replace","jsonStringify","replacer","space","JSON","stringify","originalToJSON","undefined","hasToJSON","toJSON","result","originalProtoToJSON","getPrototypeOf","e","getMethods","funcs","push","replaceNumberCharByPath","path","getStatusGroup","status","substr","getQueryParamsFromUrl","url","queryString","split","getURLSearchParams","extend","source","extend2Lev","now","Date","getTime","noop","findByPath","pathArr","shift","withSnakeCaseKeys","candidate","keys","word","uppercaseLetter","index","toLowerCase","deepSnakeCase","map","escapeRowData","str","urlParse","para","URLParser","a","this","_fields","Username","Password","Port","Protocol","Host","Path","URL","QueryString","Fragment","_values","_regex","_parse","setUrl","_initValues","addQueryString","queryObj","query","RegExp","getParse","getUrl","Origin","b","exec","c","getOwnObjectKeys","isEnumerable","getOwnPropertySymbols","symbols","filter","t","getOwnPropertyDescriptor","apply","defineObject","configurable","writable","buildEnv","sdkVersion","sdkName","LifeCycle","callbacks","eventType","eventCallbacks","callback","unsubscribe","other","LifeCycleEventType","PERFORMANCE_ENTRY_COLLECTED","AUTO_ACTION_CREATED","AUTO_ACTION_COMPLETED","AUTO_ACTION_DISCARDED","APP_HIDE","APP_UPDATE","PAGE_SET_DATA_UPDATE","PAGE_ALIAS_ACTION","VIEW_CREATED","VIEW_UPDATED","VIEW_ENDED","REQUEST_STARTED","REQUEST_COMPLETED","RAW_RUM_EVENT_COLLECTED","RUM_EVENT_COLLECTED","DEFAULT_CONFIGURATION","sampleRate","flushTimeout","maxErrorsByMinute","maxBatchSize","maxMessageSize","batchBytesLimit","datakitUrl","requestErrorResponseLengthLimit","trackInteractions","isIntakeRequest","configuration","url1","url2","parseUrl1","parseUrl2","haveSameOrigin","ErrorSource","toStackTraceString","stack","name","message","frame","func","args","join","line","column","instance","sdk","tracker","wx","request","targetObj","target","getOwnPropertyDescriptors","defineProperties","deepMixObject","err","getSDK","UNKNOWN_FUNCTION","has","object","xhrProxySingleton","onErrorHandlerInstalled","onUnhandledRejectionHandlerInstalled","onPageNotFoundHandlerInstalled","onOnMemoryWarningHandlerInstalled","handlers","notifyHandlers","isWindowError","error","exception","inner","traceKitWindowOnError","Error","msg","computeStackTrace","messages","groups","match","ERROR_TYPES_RE","traceKitWindowOnUnhandledRejection","reason","promise","doReport","ex","subscribe","handler","onError","installGlobalHandler","onUnhandledRejection","installGlobalUnhandledRejectionHandler","onPageNotFound","res","type","installGlobalOnPageNotFoundHandler","onMemoryWarning","level","levelMessage","installGlobalOnMemoryWarningHandler","splice","debug","computeStackTraceFromStackProp","isEval","submatch","parts","element","chrome","gecko","winjs","geckoEval","chromeEval","lines","j","isNative","indexOf","columnNumber","extractMessage","augmentStackTraceWithInitialElement","stackInfo","lineNo","initial","incompvare","unshift","partial","computeStackTraceByWalkingCallerChain","depth","item","functionName","recursion","curr","caller","input","substring","sourceURL","fileName","lineNumber","description","doComputeStackTrace","normalizedDepth","stacktrace","opera10Regex","opera11Regex","computeStackTraceFromStacktraceProp","lineRE1","lineRE2","lineRE3","scripts","window","document","getElementsByTagName","inlineScriptBlocks","s","src","location","href","computeStackTraceFromOperaMultiLineMessage","ofCaller","currentDepth","Observable","observers","f","observer","originalXhrRequest","downloadProxySingleton","beforeSendCallbacks","onRequestCompleteCallbacks","startXhrProxy","_this","dataflux_xhr","method","startTime","responseType","originalSuccess","success","reportXhr","originalFail","fail","hasBeenReported","response","header","profile","statusCode","beforeSend","onRequestComplete","originalDownloadRequest","originalConsoleError","traceKitReportHandler","filteredErrorsObservable","startDownloadProxy","downloadFile","filePath","tempFilePath","formatConsoleParameters","param","startRuntimeErrorTracking","errorObservable","stackTrace","_","errorObject","nonErrorPrefix","formatUnknownError","notify","startAutomaticErrorCollection","handleCompleteRequest","isRejected","isServerError","format","resource","truncateResponse","trackNetworkError","console","concat","startConsoleTracking","errorCount","filteredErrorObservable","setInterval","filterErrors","startErrorCollection","lifeCycle","observable","urlObj","statusGroup","urlHost","urlPath","urlPathGroup","rawRumEvent","date","starttime","processError","doStartErrorCollection","sessionId","getDeviceInfo","getNetWork","deviceInfo","getSystemInfoSync","osInfo","system","osVersion","osVersionMajor","deviceUUid","host","appId","screenSize","screenWidth","screenHeight","platform","platformVersion","version","os","brand","model","frameworkVersion","SDKVersion","pixelRatio","deviceUuid","clienetId","getStorageSync","setStorageSync","getNetworkType","network","networkType","onNetworkStatusChange","isTracked","threshold","SessionType","startParentContexts","currentView","currentAction","previousViews","previousActions","currentContext","id","endTime","endClocks","buildCurrentViewContext","action","buildCurrentActionContext","startClocks","SESSION_RENEWED","clearOldContextsInterval","previousContexts","timeOutDelay","oldTimeThreshold","pop","clearOldContexts","userAction","page","referer","route","findContext","buildContext","flag","previousContext","findView","findAction","stop","clearInterval","commonTags","sdk_name","sdk_version","app_id","env","userid","session_id","session_type","is_signin","device","device_uuid","os_version","os_version_major","screen_size","network_type","platform_version","app_framework_version","view_id","view_name","view_referer","dataMap","view","tags","view_apdex_level","is_active","fields","page_fmp","first_paint_time","loading_time","onload_to_onshow","onshow_to_onready","time_spent","view_error_count","view_resource_count","view_long_task_count","view_action_count","view_setdata_count","resource_type","resource_status","resource_status_group","resource_method","resource_url","resource_url_host","resource_url_path","resource_url_path_group","resource_url_query","resource_size","resource_load","resource_dns","resource_tcp","resource_ssl","resource_ttfb","resource_trans","resource_first_byte","error_source","error_type","error_message","error_stack","long_task","action_id","action_name","action_type","action_error_count","action_resource_count","action_long_task_count","app","alias_key","HAS_MULTI_BYTES_CHARACTERS","httpRequest","endpointUrl","bytesLimit","send","addBatchPrecision","HttpRequest","batch","maxSize","flushOnVisibilityHidden","flushPeriodically","pushOnlyBuffer","upsertBuffer","bufferBytesSize","bufferMessageCount","add","addOrUpdate","upsert","flush","processSendData","rowStr","hasFileds","tagsStr","value_path","_key","_value","fieldsStr","_valueData","sizeInBytes","charCode","total","len","charCodeAt","process","processedMessage","messageBytesSize","hasMessageFor","remove","willReachedBytesLimitWith","isFull","removedMessage","setTimeout","Batch","startRumBatch","primaryBatch","createRumBatch","stopped","makeRumBatch","serverRumEvent","trackEventCounts","eventCounts","resourceCount","longTaskCount","userActionCount","subscription","newView","loadingTime","showTime","onload2onshowTime","onshow2onready","stayTime","fpt","fmp","isActive","setdataCount","documentVersion","setdataDuration","loadingDuration","scheduleViewUpdate","wait","options","timeout","previous","later","leading","throttled","remaining","clearTimeout","trailing","cancel","throttle","triggerViewUpdate","cancelScheduleViewUpdate","stopEventCountsTracking","newEventCounts","stopFptTracking","entitys","firstRenderEntity","find","entity","entryType","trackFptTime","stopSetDataTracking","updateEndTimestamp","pendingStartTimestamp","trackSetDataTime","stopLoadingTimeTracking","navigationEnity","trackLoadingTime","scheduleUpdate","setLoadEventEnd","triggerUpdate","end","getActivePage","curPages","getCurrentPages","startViewCollection","apdexLevel","Number","_dd","count","setdata","setdata_duration","onload2onshow","timeSpent","processViewUpdate","originPage","Page","methodName","userDefinedMethod","activePage","rewritePage","computePerformanceResourceDuration","entry","responseEnd","computePerformanceResourceDetails","validEntry","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","hasRedirection","redirectStart","redirectEnd","toValidEntry","domainLookUpStart","domainLookUpEnd","SSLconnectionStart","SSLconnectionEnd","details","firstbyte","formatTiming","trans","ttfb","tcp","ssl","dns","redirect","origin","start","computeSize","receivedBytedCount","isAllowedRequestUrl","nextRequestIndex","startRequestCollection","xhrProxy","requestIndex","getNextRequestIndex","performance","trackXhr","dwonloadProxy","trackDownload","startResourceCollection","timing","correspondingTimingOverrides","load","size","computePerformanceEntryMetrics","resourceEvent","urlQuery","processRequest","startupTypes","rewriteApp","originApp","App","appInfo","isStartUp","isHide","startupType","codeDownloadDuration","launchEntity","navigationType","scriptentity","firstEntity","startPerformanceObservable","startAppCollection","appinfo","processAppUpdate","waitIdlePageActivity","completionCallback","_trackPageActivities","firstRequestIndex","subscriptions","pendingRequestsCount","notifyPageActivity","isBusy","startEvent","sub","trackPageActivities","pageActivitiesObservable","stopPageActivitiesTracking","stopWaitPageActivitiesCompletion","idleTimeoutId","hasCompleted","validationTimeoutId","complete","hadActivity","maxDurationTimeoutId","params","lastChangeTime","waitPageActivitiesCompletion","trackActions","currentIdlePageActivitySubscription","create","pendingAutoAction","PendingAutoAction","discard","discardCurrent","startActionManagement","clickProxy","_action","originComponent","Component","component","oirginMethod","currentTarget","dataset","actionType","content","title","text","pagePath","eventCountsSubscription","startActionCollection","autoActionProperties","counts","processAction","datafluxRum","startRumImpl","userConfiguration","transportConfiguration","applicationId","datakitOrigin","lastIndexOf","commonInit","parentContexts","viewContext","deviceContext","baseInfo","actionContext","rumContext","application","session","getSessionId","user","user_id","getClientID","startRumAssembly","getPerformance","createObserver","entryList","getEntries","observe","entryTypes","startPagePerformanceObservable","originPageOnLoad","setUpdatePerformanceListener","withDataPaths","originComponentAttached","startSetDataColloction","isAlreadyInitialized","init","canInitRum"],"mappings":"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","file":"dataflux-rum-miniapp.js","sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export const ONE_SECOND = 1000\nexport const ONE_MINUTE = 60 * ONE_SECOND\nexport const ONE_HOUR = 60 * ONE_MINUTE\nexport const ONE_KILO_BYTE = 1024\nexport const CLIENT_ID_TOKEN = 'datafluxRum:client:id'\nexport const RumEventType = {\n\tACTION: 'action',\n\tERROR: 'error',\n\tLONG_TASK: 'long_task',\n\tVIEW: 'view',\n\tRESOURCE: 'resource',\n\tAPP: 'app',\n\tACTION: 'action',\n}\n\nexport var RequestType = {\n\tXHR: 'network',\n\tDOWNLOAD: 'resource',\n}\n\nexport var ActionType = {\n\ttap: 'tap',\n\tlongpress: 'longpress',\n\tlongtap: 'longtap',\n}\nexport var MpHook = {\n\tdata: 1,\n\tonLoad: 1,\n\tonShow: 1,\n\tonReady: 1,\n\tonPullDownRefresh: 1,\n\tonReachBottom: 1,\n\tonShareAppMessage: 1,\n\tonPageScroll: 1,\n\tonResize: 1,\n\tonTabItemTap: 1,\n\tonHide: 1,\n\tonUnload: 1,\n}\n","import { MpHook } from './enums'\nvar ArrayProto = Array.prototype\nvar ObjProto = Object.prototype\nvar ObjProto = Object.prototype\nvar hasOwnProperty = ObjProto.hasOwnProperty\nvar slice = ArrayProto.slice\nvar toString = ObjProto.toString\nvar nativeForEach = ArrayProto.forEach\nvar breaker = false\nexport var isArguments = function (obj) {\n\treturn !!(obj && hasOwnProperty.call(obj, 'callee'))\n}\nexport var each = function (obj, iterator, context) {\n\tif (obj === null) return false\n\tif (nativeForEach && obj.forEach === nativeForEach) {\n\t\tobj.forEach(iterator, context)\n\t} else if (obj.length === +obj.length) {\n\t\tfor (var i = 0, l = obj.length; i < l; i++) {\n\t\t\tif (i in obj && iterator.call(context, obj[i], i, obj) === breaker) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var key in obj) {\n\t\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\t\tif (iterator.call(context, obj[key], key, obj) === breaker) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nexport var values = function (obj) {\n\tvar results = []\n\tif (obj === null) {\n\t\treturn results\n\t}\n\teach(obj, function (value) {\n\t\tresults[results.length] = value\n\t})\n\treturn results\n}\nexport function round(num, decimals) {\n\treturn +num.toFixed(decimals)\n}\n\nexport function msToNs(duration) {\n\tif (typeof duration !== 'number') {\n\t\treturn duration\n\t}\n\treturn round(duration * 1e6, 0)\n}\nexport var isUndefined = function (obj) {\n\treturn obj === void 0\n}\nexport var isString = function (obj) {\n\treturn toString.call(obj) === '[object String]'\n}\nexport var isDate = function (obj) {\n\treturn toString.call(obj) === '[object Date]'\n}\nexport var isBoolean = function (obj) {\n\treturn toString.call(obj) === '[object Boolean]'\n}\nexport var isNumber = function (obj) {\n\treturn toString.call(obj) === '[object Number]' && /[\\d\\.]+/.test(String(obj))\n}\n\nexport var toArray = function (iterable) {\n\tif (!iterable) return []\n\tif (iterable.toArray) {\n\t\treturn iterable.toArray()\n\t}\n\tif (Array.isArray(iterable)) {\n\t\treturn slice.call(iterable)\n\t}\n\tif (isArguments(iterable)) {\n\t\treturn slice.call(iterable)\n\t}\n\treturn values(iterable)\n}\nexport var areInOrder = function () {\n\tvar numbers = toArray(arguments)\n\tfor (var i = 1; i < numbers.length; i += 1) {\n\t\tif (numbers[i - 1] > numbers[i]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n/**\n * UUID v4\n * from https://gist.github.com/jed/982883\n */\nexport function UUID(placeholder) {\n\treturn placeholder\n\t\t? // tslint:disable-next-line no-bitwise\n\t\t  (\n\t\t\t\tparseInt(placeholder, 10) ^\n\t\t\t\t((Math.random() * 16) >> (parseInt(placeholder, 10) / 4))\n\t\t  ).toString(16)\n\t\t: `${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`.replace(/[018]/g, UUID)\n}\nexport function jsonStringify(value, replacer, space) {\n\tif (value === null || value === undefined) {\n\t\treturn JSON.stringify(value)\n\t}\n\tvar originalToJSON = [false, undefined]\n\tif (hasToJSON(value)) {\n\t\t// We need to add a flag and not rely on the truthiness of value.toJSON\n\t\t// because it can be set but undefined and that's actually significant.\n\t\toriginalToJSON = [true, value.toJSON]\n\t\tdelete value.toJSON\n\t}\n\n\tvar originalProtoToJSON = [false, undefined]\n\tvar prototype\n\tif (typeof value === 'object') {\n\t\tprototype = Object.getPrototypeOf(value)\n\t\tif (hasToJSON(prototype)) {\n\t\t\toriginalProtoToJSON = [true, prototype.toJSON]\n\t\t\tdelete prototype.toJSON\n\t\t}\n\t}\n\n\tvar result\n\ttry {\n\t\tresult = JSON.stringify(value, undefined, space)\n\t} catch (e) {\n\t\tresult = '<error: unable to serialize object>'\n\t} finally {\n\t\tif (originalToJSON[0]) {\n\t\t\tvalue.toJSON = originalToJSON[1]\n\t\t}\n\t\tif (originalProtoToJSON[0]) {\n\t\t\tprototype.toJSON = originalProtoToJSON[1]\n\t\t}\n\t}\n\treturn result\n}\nfunction hasToJSON(value) {\n\treturn (\n\t\ttypeof value === 'object' &&\n\t\tvalue !== null &&\n\t\tvalue.hasOwnProperty('toJSON')\n\t)\n}\nexport function elapsed(start, end) {\n\treturn end - start\n}\nexport function getMethods(obj) {\n\tvar funcs = []\n\tfor (var key in obj) {\n\t\tif (typeof obj[key] === 'function' && !MpHook[key]) {\n\t\t\tfuncs.push(key)\n\t\t}\n\t}\n\treturn funcs\n}\n// 替换url包含数字的路由\nexport function replaceNumberCharByPath(path) {\n\tif (path) {\n\t\treturn path.replace(/\\/([^\\/]*)\\d([^\\/]*)/g, '/?')\n\t} else {\n\t\treturn ''\n\t}\n}\nexport function getStatusGroup(status) {\n\tif (!status) return status\n\treturn (\n\t\tString(status).substr(0, 1) + String(status).substr(1).replace(/\\d*/g, 'x')\n\t)\n}\nexport var getQueryParamsFromUrl = function (url) {\n\tvar result = {}\n\tvar arr = url.split('?')\n\tvar queryString = arr[1] || ''\n\tif (queryString) {\n\t\tresult = getURLSearchParams('?' + queryString)\n\t}\n\treturn result\n}\nexport function isPercentage(value) {\n\treturn isNumber(value) && value >= 0 && value <= 100\n}\n\nexport var extend = function (obj) {\n\tslice.call(arguments, 1).forEach(function (source) {\n\t\tfor (var prop in source) {\n\t\t\tif (source[prop] !== void 0) {\n\t\t\t\tobj[prop] = source[prop]\n\t\t\t}\n\t\t}\n\t})\n\treturn obj\n}\nexport var extend2Lev = function (obj) {\n\tslice.call(arguments, 1).forEach(function (source) {\n\t\tfor (var prop in source) {\n\t\t\tif (source[prop] !== void 0) {\n\t\t\t\tif (isObject(source[prop]) && isObject(obj[prop])) {\n\t\t\t\t\textend(obj[prop], source[prop])\n\t\t\t\t} else {\n\t\t\t\t\tobj[prop] = source[prop]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n\treturn obj\n}\n\nexport var trim = function (str) {\n\treturn str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\nexport var isObject = function (obj) {\n\tif (obj === null) return false\n\treturn toString.call(obj) === '[object Object]'\n}\nexport var isEmptyObject = function (obj) {\n\tif (isObject(obj)) {\n\t\tfor (var key in obj) {\n\t\t\tif (hasOwnProperty.call(obj, key)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t\treturn true\n\t} else {\n\t\treturn false\n\t}\n}\n\nexport var isJSONString = function (str) {\n\ttry {\n\t\tJSON.parse(str)\n\t} catch (e) {\n\t\treturn false\n\t}\n\treturn true\n}\nexport var safeJSONParse = function (str) {\n\tvar val = null\n\ttry {\n\t\tval = JSON.parse(str)\n\t} catch (e) {\n\t\treturn false\n\t}\n\treturn val\n}\nexport var now =\n\tDate.now ||\n\tfunction () {\n\t\treturn new Date().getTime()\n\t}\nexport var throttle = function (func, wait, options) {\n\tvar timeout, context, args, result\n\tvar previous = 0\n\tif (!options) options = {}\n\n\tvar later = function () {\n\t\tprevious = options.leading === false ? 0 : new Date().getTime()\n\t\ttimeout = null\n\t\tresult = func.apply(context, args)\n\t\tif (!timeout) context = args = null\n\t}\n\n\tvar throttled = function () {\n\t\targs = arguments\n\t\tvar now = new Date().getTime()\n\t\tif (!previous && options.leading === false) previous = now\n\t\t//下次触发 func 剩余的时间\n\t\tvar remaining = wait - (now - previous)\n\t\tcontext = this\n\t\t// 如果没有剩余的时间了或者你改了系统时间\n\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\tif (timeout) {\n\t\t\t\tclearTimeout(timeout)\n\t\t\t\ttimeout = null\n\t\t\t}\n\t\t\tprevious = now\n\t\t\tresult = func.apply(context, args)\n\t\t\tif (!timeout) context = args = null\n\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\ttimeout = setTimeout(later, remaining)\n\t\t}\n\t\treturn result\n\t}\n\tthrottled.cancel = function () {\n\t\tclearTimeout(timeout)\n\t\tprevious = 0\n\t\ttimeout = null\n\t}\n\treturn throttled\n}\nexport function noop() {}\n/**\n * Return true if the draw is successful\n * @param threshold between 0 and 100\n */\nexport function performDraw(threshold) {\n\treturn threshold !== 0 && Math.random() * 100 <= threshold\n}\nexport function findByPath(source, path) {\n\tvar pathArr = path.split('.')\n\twhile (pathArr.length) {\n\t\tvar key = pathArr.shift()\n\t\tif (source && key in source && hasOwnProperty.call(source, key)) {\n\t\t\tsource = source[key]\n\t\t} else {\n\t\t\treturn undefined\n\t\t}\n\t}\n\treturn source\n}\nexport function withSnakeCaseKeys(candidate) {\n\tconst result = {}\n\tObject.keys(candidate).forEach((key) => {\n\t\tresult[toSnakeCase(key)] = deepSnakeCase(candidate[key])\n\t})\n\treturn result\n}\n\nexport function deepSnakeCase(candidate) {\n\tif (Array.isArray(candidate)) {\n\t\treturn candidate.map((value) => deepSnakeCase(value))\n\t}\n\tif (typeof candidate === 'object' && candidate !== null) {\n\t\treturn withSnakeCaseKeys(candidate)\n\t}\n\treturn candidate\n}\n\nexport function toSnakeCase(word) {\n\treturn word\n\t\t.replace(/[A-Z]/g, function (uppercaseLetter, index) {\n\t\t\treturn (index !== 0 ? '_' : '') + uppercaseLetter.toLowerCase()\n\t\t})\n\t\t.replace(/-/g, '_')\n}\n\nexport function escapeRowData(str) {\n\tif (!isString(str)) return str\n\tvar reg = /[\\s=,\"]/g\n\treturn String(str).replace(reg, function (word) {\n\t\treturn '\\\\' + word\n\t})\n}\nexport var urlParse = function (para) {\n\tvar URLParser = function (a) {\n\t\tthis._fields = {\n\t\t\tUsername: 4,\n\t\t\tPassword: 5,\n\t\t\tPort: 7,\n\t\t\tProtocol: 2,\n\t\t\tHost: 6,\n\t\t\tPath: 8,\n\t\t\tURL: 0,\n\t\t\tQueryString: 9,\n\t\t\tFragment: 10,\n\t\t}\n\t\tthis._values = {}\n\t\tthis._regex = null\n\t\tthis._regex = /^((\\w+):\\/\\/)?((\\w+):?(\\w+)?@)?([^\\/\\?:]+):?(\\d+)?(\\/?[^\\?#]+)?\\??([^#]+)?#?(\\w*)/\n\n\t\tif (typeof a != 'undefined') {\n\t\t\tthis._parse(a)\n\t\t}\n\t}\n\tURLParser.prototype.setUrl = function (a) {\n\t\tthis._parse(a)\n\t}\n\tURLParser.prototype._initValues = function () {\n\t\tfor (var a in this._fields) {\n\t\t\tthis._values[a] = ''\n\t\t}\n\t}\n\tURLParser.prototype.addQueryString = function (queryObj) {\n\t\tif (typeof queryObj !== 'object') {\n\t\t\treturn false\n\t\t}\n\t\tvar query = this._values.QueryString || ''\n\t\tfor (var i in queryObj) {\n\t\t\tif (new RegExp(i + '[^&]+').test(query)) {\n\t\t\t\tquery = query.replace(new RegExp(i + '[^&]+'), i + '=' + queryObj[i])\n\t\t\t} else {\n\t\t\t\tif (query.slice(-1) === '&') {\n\t\t\t\t\tquery = query + i + '=' + queryObj[i]\n\t\t\t\t} else {\n\t\t\t\t\tif (query === '') {\n\t\t\t\t\t\tquery = i + '=' + queryObj[i]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tquery = query + '&' + i + '=' + queryObj[i]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._values.QueryString = query\n\t}\n\tURLParser.prototype.getParse = function () {\n\t\treturn this._values\n\t}\n\tURLParser.prototype.getUrl = function () {\n\t\tvar url = ''\n\t\turl += this._values.Origin\n\t\turl += this._values.Port ? ':' + this._values.Port : ''\n\t\turl += this._values.Path\n\t\turl += this._values.QueryString ? '?' + this._values.QueryString : ''\n\t\treturn url\n\t}\n\tURLParser.prototype._parse = function (a) {\n\t\tthis._initValues()\n\t\tvar b = this._regex.exec(a)\n\t\tif (!b) {\n\t\t\tthrow 'DPURLParser::_parse -> Invalid URL'\n\t\t}\n\t\tfor (var c in this._fields) {\n\t\t\tif (typeof b[this._fields[c]] != 'undefined') {\n\t\t\t\tthis._values[c] = b[this._fields[c]]\n\t\t\t}\n\t\t}\n\t\tthis._values['Hostname'] = this._values['Host'].replace(/:\\d+$/, '')\n\t\tthis._values['Origin'] =\n\t\t\tthis._values['Protocol'] + '://' + this._values['Hostname']\n\t}\n\treturn new URLParser(para)\n}\nexport const getOwnObjectKeys = function (obj, isEnumerable) {\n\tvar keys = Object.keys(obj)\n\tif (Object.getOwnPropertySymbols) {\n\t\tvar symbols = Object.getOwnPropertySymbols(obj)\n\t\tif (isEnumerable) {\n\t\t\tsymbols = symbols.filter(function (t) {\n\t\t\t\treturn Object.getOwnPropertyDescriptor(obj, t).enumerable\n\t\t\t})\n\t\t}\n\t\tkeys.push.apply(keys, symbols)\n\t}\n\treturn keys\n}\nexport const defineObject = function (obj, key, value) {\n\tif (key in obj) {\n\t\tObject.defineProperty(obj, key, {\n\t\t\tvalue,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\twritable: true,\n\t\t})\n\t} else {\n\t\tobj[key] = value\n\t}\n\treturn obj\n}\nexport const deepMixObject = function (targetObj) {\n\tfor (var t = 1; t < arguments.length; t++) {\n\t\tvar target = arguments[t] != null ? arguments[t] : {}\n\t\tif (t % 2) {\n\t\t\tgetOwnObjectKeys(Object(target), true).forEach(function (t) {\n\t\t\t\tdefineObject(targetObj, t, target[t])\n\t\t\t})\n\t\t} else {\n\t\t\tif (Object.getOwnPropertyDescriptors) {\n\t\t\t\tObject.defineProperties(\n\t\t\t\t\ttargetObj,\n\t\t\t\t\tObject.getOwnPropertyDescriptors(target),\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tgetOwnObjectKeys(Object(target)).forEach(function (t) {\n\t\t\t\t\tObject.defineProperty(\n\t\t\t\t\t\ttargetObj,\n\t\t\t\t\t\tt,\n\t\t\t\t\t\tObject.getOwnPropertyDescriptor(target, t),\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\treturn targetObj\n}\n","export const buildEnv = {\n\tsdkVersion: '<<< SDK_VERSION >>>',\n\tsdkName: 'df_miniapp_rum_sdk',\n}\n","export class LifeCycle {\n\tconstructor() {\n\t\tthis.callbacks = {}\n\t}\n\tnotify(eventType, data) {\n\t\tconst eventCallbacks = this.callbacks[eventType]\n\t\tif (eventCallbacks) {\n\t\t\teventCallbacks.forEach((callback) => callback(data))\n\t\t}\n\t}\n\tsubscribe(eventType, callback) {\n\t\tif (!this.callbacks[eventType]) {\n\t\t\tthis.callbacks[eventType] = []\n\t\t}\n\t\tthis.callbacks[eventType].push(callback)\n\t\treturn {\n\t\t\tunsubscribe: () => {\n\t\t\t\tthis.callbacks[eventType] = this.callbacks[eventType].filter(\n\t\t\t\t\t(other) => callback !== other,\n\t\t\t\t)\n\t\t\t},\n\t\t}\n\t}\n}\n\nexport var LifeCycleEventType = {\n\tPERFORMANCE_ENTRY_COLLECTED: 'PERFORMANCE_ENTRY_COLLECTED',\n\tAUTO_ACTION_CREATED: 'AUTO_ACTION_CREATED',\n\tAUTO_ACTION_COMPLETED: 'AUTO_ACTION_COMPLETED',\n\tAUTO_ACTION_DISCARDED: 'AUTO_ACTION_DISCARDED',\n\tAPP_HIDE: 'APP_HIDE',\n\tAPP_UPDATE: 'APP_UPDATE',\n\tPAGE_SET_DATA_UPDATE: 'PAGE_SET_DATA_UPDATE',\n\tPAGE_ALIAS_ACTION: 'PAGE_ALIAS_ACTION',\n\tVIEW_CREATED: 'VIEW_CREATED',\n\tVIEW_UPDATED: 'VIEW_UPDATED',\n\tVIEW_ENDED: 'VIEW_ENDED',\n\tREQUEST_STARTED: 'REQUEST_STARTED',\n\tREQUEST_COMPLETED: 'REQUEST_COMPLETED',\n\tRAW_RUM_EVENT_COLLECTED: 'RAW_RUM_EVENT_COLLECTED',\n\tRUM_EVENT_COLLECTED: 'RUM_EVENT_COLLECTED',\n}\n","import { extend2Lev, urlParse } from '../helper/utils'\nimport { ONE_KILO_BYTE, ONE_SECOND } from '../helper/enums'\nexport var DEFAULT_CONFIGURATION = {\n\tsampleRate: 100,\n\tflushTimeout: 30 * ONE_SECOND,\n\tmaxErrorsByMinute: 3000,\n\t/**\n\t * Logs intake limit\n\t */\n\tmaxBatchSize: 50,\n\tmaxMessageSize: 256 * ONE_KILO_BYTE,\n\n\t/**\n\t * beacon payload max queue size implementation is 64kb\n\t * ensure that we leave room for logs, rum and potential other users\n\t */\n\tbatchBytesLimit: 16 * ONE_KILO_BYTE,\n\tdatakitUrl: '',\n\t/**\n\t * arbitrary value, byte precision not needed\n\t */\n\trequestErrorResponseLengthLimit: 32 * ONE_KILO_BYTE,\n\ttrackInteractions: false,\n}\n\nfunction getDatakitUrlUrl(url) {\n\tif (url && url.lastIndexOf('/') === url.length - 1)\n\t\treturn url + 'v1/write/rum'\n\treturn url + '/v1/write/rum'\n}\nexport function commonInit(userConfiguration, buildEnv) {\n\tvar transportConfiguration = {\n\t\tapplicationId: userConfiguration.applicationId,\n\t\tenv: userConfiguration.env || '',\n\t\tversion: userConfiguration.version || '',\n\t\tsdkVersion: buildEnv.sdkVersion,\n\t\tsdkName: buildEnv.sdkName,\n\t\tdatakitUrl: getDatakitUrlUrl(\n\t\t\tuserConfiguration.datakitUrl || userConfiguration.datakitOrigin,\n\t\t),\n\t\ttags: userConfiguration.tags || [],\n\t}\n\tif ('trackInteractions' in userConfiguration) {\n\t\ttransportConfiguration.trackInteractions = !!userConfiguration.trackInteractions\n\t}\n\treturn extend2Lev(DEFAULT_CONFIGURATION, transportConfiguration)\n}\nconst haveSameOrigin = function (url1, url2) {\n\tconst parseUrl1 = urlParse(url1).getParse()\n\tconst parseUrl2 = urlParse(url2).getParse()\n\treturn parseUrl1.Origin === parseUrl2.Origin\n}\nexport function isIntakeRequest(url, configuration) {\n\treturn haveSameOrigin(url, configuration.datakitUrl)\n}\n","export var ErrorSource = {\n\tAGENT: 'agent',\n\tCONSOLE: 'console',\n\tNETWORK: 'network',\n\tSOURCE: 'source',\n\tLOGGER: 'logger',\n}\nexport function formatUnknownError(stackTrace, errorObject, nonErrorPrefix) {\n\tif (\n\t\t!stackTrace ||\n\t\t(stackTrace.message === undefined && !(errorObject instanceof Error))\n\t) {\n\t\treturn {\n\t\t\tmessage: nonErrorPrefix + '' + JSON.stringify(errorObject),\n\t\t\tstack: 'No stack, consider using an instance of Error',\n\t\t\ttype: stackTrace && stackTrace.name,\n\t\t}\n\t}\n\treturn {\n\t\tmessage: stackTrace.message || 'Empty message',\n\t\tstack: toStackTraceString(stackTrace),\n\t\ttype: stackTrace.name,\n\t}\n}\n\nexport function toStackTraceString(stack) {\n\tvar result = stack.name || 'Error' + ': ' + stack.message\n\tstack.stack.forEach(function (frame) {\n\t\tvar func = frame.func === '?' ? '<anonymous>' : frame.func\n\t\tvar args =\n\t\t\tframe.args && frame.args.length > 0\n\t\t\t\t? '(' + frame.args.join(', ') + ')'\n\t\t\t\t: ''\n\t\tvar line = frame.line ? ':' + frame.line : ''\n\t\tvar column = frame.line && frame.column ? ':' + frame.column : ''\n\t\tresult += '\\n  at ' + func + args + ' @ ' + frame.url + line + column\n\t})\n\treturn result\n}\n","import { deepMixObject } from '../helper/utils'\n\nfunction getSDK() {\n\tvar sdk = null,\n\t\ttracker = ''\n\ttry {\n\t\tif (wx && typeof wx === 'object' && typeof wx.request === 'function') {\n\t\t\tsdk = deepMixObject({}, wx)\n\t\t\ttracker = 'wx'\n\t\t\twx = sdk\n\t\t}\n\t} catch (err) {\n\t\tconsole.warn('unsupport platform, Fail to start')\n\t}\n\tconsole.log('------get SDK-------')\n\treturn { sdk, tracker }\n}\nconst instance = getSDK()\n\nexport const sdk = instance.sdk\nexport const tracker = instance.tracker\n","import { sdk } from '../core/sdk'\n\nconst UNKNOWN_FUNCTION = '?'\nfunction has(object, key) {\n\treturn Object.prototype.hasOwnProperty.call(object, key)\n}\nfunction isUndefined(what) {\n\treturn typeof what === 'undefined'\n}\nexport function wrap(func) {\n\tvar _this = this\n\tfunction wrapped() {\n\t\ttry {\n\t\t\treturn func.apply(_this, arguments)\n\t\t} catch (e) {\n\t\t\treport(e)\n\t\t\tthrow e\n\t\t}\n\t}\n\treturn wrapped\n}\n/**\n * Cross-browser processing of unhandled exceptions\n *\n * Syntax:\n * ```js\n *   report.subscribe(function(stackInfo) { ... })\n *   report.unsubscribe(function(stackInfo) { ... })\n *   report(exception)\n *   try { ...code... } catch(ex) { report(ex); }\n * ```\n *\n * Supports:\n *   - Firefox: full stack trace with line numbers, plus column number\n *     on top frame; column number is not guaranteed\n *   - Opera: full stack trace with line and column numbers\n *   - Chrome: full stack trace with line and column numbers\n *   - Safari: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *   - IE: line and column number for the top frame only; some frames\n *     may be missing, and column number is not guaranteed\n *\n * In theory, TraceKit should work on all of the following versions:\n *   - IE5.5+ (only 8.0 tested)\n *   - Firefox 0.9+ (only 3.5+ tested)\n *   - Opera 7+ (only 10.50 tested; versions 9 and earlier may require\n *     Exceptions Have Stacktrace to be enabled in opera:config)\n *   - Safari 3+ (only 4+ tested)\n *   - Chrome 1+ (only 5+ tested)\n *   - Konqueror 3.5+ (untested)\n *\n * Requires computeStackTrace.\n *\n * Tries to catch all unhandled exceptions and report them to the\n * subscribed handlers. Please note that report will rethrow the\n * exception. This is REQUIRED in order to get a useful stack trace in IE.\n * If the exception does not reach the top of the browser, you will only\n * get a stack trace from the point where report was called.\n *\n * Handlers receive a StackTrace object as described in the\n * computeStackTrace docs.\n *\n * @memberof TraceKit\n * @namespace\n */\nexport var report = (function reportModuleWrapper() {\n\tvar handlers = []\n\n\t/**\n\t * Add a crash handler.\n\t * @param {Function} handler\n\t * @memberof report\n\t */\n\tfunction subscribe(handler) {\n\t\tinstallGlobalHandler()\n\t\tinstallGlobalUnhandledRejectionHandler()\n\t\tinstallGlobalOnPageNotFoundHandler()\n\t\tinstallGlobalOnMemoryWarningHandler()\n\t\thandlers.push(handler)\n\t}\n\n\t/**\n\t * Remove a crash handler.\n\t * @param {Function} handler\n\t * @memberof report\n\t */\n\tfunction unsubscribe(handler) {\n\t\tfor (var i = handlers.length - 1; i >= 0; i -= 1) {\n\t\t\tif (handlers[i] === handler) {\n\t\t\t\thandlers.splice(i, 1)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Dispatch stack information to all handlers.\n\t * @param {StackTrace} stack\n\t * @param {boolean} isWindowError Is this a top-level window error?\n\t * @param {Error=} error The error that's being handled (if available, null otherwise)\n\t * @memberof report\n\t * @throws An exception if an error occurs while calling an handler.\n\t */\n\tfunction notifyHandlers(stack, isWindowError, error) {\n\t\tvar exception\n\t\tfor (var i in handlers) {\n\t\t\tif (has(handlers, i)) {\n\t\t\t\ttry {\n\t\t\t\t\thandlers[i](stack, isWindowError, error)\n\t\t\t\t} catch (inner) {\n\t\t\t\t\texception = inner\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (exception) {\n\t\t\tthrow exception\n\t\t}\n\t}\n\n\tvar onErrorHandlerInstalled\n\tvar onUnhandledRejectionHandlerInstalled\n\tvar onPageNotFoundHandlerInstalled\n\tvar onOnMemoryWarningHandlerInstalled\n\t/**\n\t * Ensures all global unhandled exceptions are recorded.\n\t * Supported by Gecko and IE.\n\t * @param {Event|string} message Error message.\n\t * @param {string=} url URL of script that generated the exception.\n\t * @param {(number|string)=} lineNo The line number at which the error occurred.\n\t * @param {(number|string)=} columnNo The column number at which the error occurred.\n\t * @param {Error=} errorObj The actual Error object.\n\t * @memberof report\n\t */\n\tfunction traceKitWindowOnError(err) {\n\t\tconst error = typeof err === 'string' ? new Error(err) : err\n\t\tvar stack\n\t\tvar name = ''\n\t\tvar msg = ''\n\t\tstack = computeStackTrace(error)\n\t\tif (\n\t\t\terror &&\n\t\t\terror.message &&\n\t\t\t{}.toString.call(error.message) === '[object String]'\n\t\t) {\n\t\t\tconst messages = error.message.split('\\n')\n\t\t\tif (messages.length >= 3) {\n\t\t\t\tmsg = messages[2]\n\t\t\t\tconst groups = msg.match(ERROR_TYPES_RE)\n\t\t\t\tif (groups) {\n\t\t\t\t\tname = groups[1]\n\t\t\t\t\tmsg = groups[2]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tstack.message = msg\n\t\t}\n\t\tif (name) {\n\t\t\tstack.name = name\n\t\t}\n\t\tnotifyHandlers(stack, true, error)\n\t}\n\n\t/**\n\t * Ensures all unhandled rejections are recorded.\n\t * @param {PromiseRejectionEvent} e event.\n\t * @memberof report\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onunhandledrejection\n\t * @see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n\t */\n\tfunction traceKitWindowOnUnhandledRejection({ reason, promise }) {\n\t\tconst error = typeof reason === 'string' ? new Error(reason) : reason\n\t\tvar stack\n\t\tvar name = ''\n\t\tvar msg = ''\n\t\tstack = computeStackTrace(error)\n\t\tif (\n\t\t\terror &&\n\t\t\terror.message &&\n\t\t\t{}.toString.call(error.message) === '[object String]'\n\t\t) {\n\t\t\tconst messages = error.message.split('\\n')\n\t\t\tif (messages.length >= 3) {\n\t\t\t\tmsg = messages[2]\n\t\t\t\tconst groups = msg.match(ERROR_TYPES_RE)\n\t\t\t\tif (groups) {\n\t\t\t\t\tname = groups[1]\n\t\t\t\t\tmsg = groups[2]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (msg) {\n\t\t\tstack.message = msg\n\t\t}\n\t\tif (name) {\n\t\t\tstack.name = name\n\t\t}\n\t\tnotifyHandlers(stack, true, error)\n\t}\n\n\t/**\n\t * Install a global onerror handler\n\t * @memberof report\n\t */\n\tfunction installGlobalHandler() {\n\t\tif (onErrorHandlerInstalled || !sdk.onError) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onError(traceKitWindowOnError)\n\t\tonErrorHandlerInstalled = true\n\t}\n\n\t/**\n\t * Install a global onunhandledrejection handler\n\t * @memberof report\n\t */\n\tfunction installGlobalUnhandledRejectionHandler() {\n\t\tif (onUnhandledRejectionHandlerInstalled || !sdk.onUnhandledRejection) {\n\t\t\treturn\n\t\t}\n\n\t\tsdk.onUnhandledRejection &&\n\t\t\tsdk.onUnhandledRejection(traceKitWindowOnUnhandledRejection)\n\t\tonUnhandledRejectionHandlerInstalled = true\n\t}\n\tfunction installGlobalOnPageNotFoundHandler() {\n\t\tif (onPageNotFoundHandlerInstalled || !sdk.onPageNotFound) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onPageNotFound((res) => {\n\t\t\tconst url = res.path.split('?')[0]\n\t\t\tnotifyHandlers(\n\t\t\t\t{\n\t\t\t\t\tmessage: JSON.stringify(res),\n\t\t\t\t\ttype: 'pagenotfound',\n\t\t\t\t\tname: url + '页面无法找到',\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t)\n\t\t})\n\t\tonPageNotFoundHandlerInstalled = true\n\t}\n\tfunction installGlobalOnMemoryWarningHandler() {\n\t\tif (onOnMemoryWarningHandlerInstalled || !sdk.onMemoryWarning) {\n\t\t\treturn\n\t\t}\n\t\tsdk.onMemoryWarning(({ level = -1 }) => {\n\t\t\tlet levelMessage = '没有获取到告警级别信息'\n\n\t\t\tswitch (level) {\n\t\t\t\tcase 5:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_MODERATE'\n\t\t\t\t\tbreak\n\t\t\t\tcase 10:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_LOW'\n\t\t\t\t\tbreak\n\t\t\t\tcase 15:\n\t\t\t\t\tlevelMessage = 'TRIM_MEMORY_RUNNING_CRITICAL'\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\treturn\n\t\t\t}\n\t\t\tnotifyHandlers(\n\t\t\t\t{\n\t\t\t\t\tmessage: levelMessage,\n\t\t\t\t\ttype: 'memorywarning',\n\t\t\t\t\tname: '内存不足告警',\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t{},\n\t\t\t)\n\t\t})\n\t\tonOnMemoryWarningHandlerInstalled = true\n\t}\n\t/**\n\t * Reports an unhandled Error.\n\t * @param {Error} ex\n\t * @memberof report\n\t * @throws An exception if an incompvare stack trace is detected (old IE browsers).\n\t */\n\tfunction doReport(ex) {}\n\n\tdoReport.subscribe = subscribe\n\tdoReport.unsubscribe = unsubscribe\n\tdoReport.traceKitWindowOnError = traceKitWindowOnError\n\n\treturn doReport\n})()\n\n/**\n * computeStackTrace: cross-browser stack traces in JavaScript\n *\n * Syntax:\n *   ```js\n *   s = computeStackTrace.ofCaller([depth])\n *   s = computeStackTrace(exception) // consider using report instead (see below)\n *   ```\n *\n * Supports:\n *   - Firefox:  full stack trace with line numbers and unreliable column\n *               number on top frame\n *   - Opera 10: full stack trace with line and column numbers\n *   - Opera 9-: full stack trace with line numbers\n *   - Chrome:   full stack trace with line and column numbers\n *   - Safari:   line and column number for the topmost stacktrace element\n *               only\n *   - IE:       no line numbers whatsoever\n *\n * Tries to guess names of anonymous functions by looking for assignments\n * in the source code. In IE and Safari, we have to guess source file names\n * by searching for function bodies inside all page scripts. This will not\n * work for scripts that are loaded cross-domain.\n * Here be dragons: some function names may be guessed incorrectly, and\n * duplicate functions may be mismatched.\n *\n * computeStackTrace should only be used for tracing purposes.\n * Logging of unhandled exceptions should be done with report,\n * which builds on top of computeStackTrace and provides better\n * IE support by utilizing the sdk.onError event to retrieve information\n * about the top of the stack.\n *\n * Note: In IE and Safari, no stack trace is recorded on the Error object,\n * so computeStackTrace instead walks its *own* chain of callers.\n * This means that:\n *  * in Safari, some methods may be missing from the stack trace;\n *  * in IE, the topmost function in the stack trace will always be the\n *    caller of computeStackTrace.\n *\n * This is okay for tracing (because you are likely to be calling\n * computeStackTrace from the function you want to be the topmost element\n * of the stack trace anyway), but not okay for logging unhandled\n * exceptions (because your catch block will likely be far away from the\n * inner function that actually caused the exception).\n *\n * Tracing example:\n *  ```js\n *     function trace(message) {\n *         var stackInfo = computeStackTrace.ofCaller();\n *         var data = message + \"\\n\";\n *         for(var i in stackInfo.stack) {\n *             var item = stackInfo.stack[i];\n *             data += (item.func || '[anonymous]') + \"() in \" + item.url + \":\" + (item.line || '0') + \"\\n\";\n *         }\n *         if (window.console)\n *             console.info(data);\n *         else\n *             alert(data);\n *     }\n * ```\n * @memberof TraceKit\n * @namespace\n */\nexport var computeStackTrace = (function computeStackTraceWrapper() {\n\tvar debug = false\n\n\t// Contents of Exception in various browsers.\n\t//\n\t// SAFARI:\n\t// ex.message = Can't find variable: qq\n\t// ex.line = 59\n\t// ex.sourceId = 580238192\n\t// ex.sourceURL = http://...\n\t// ex.expressionBeginOffset = 96\n\t// ex.expressionCaretOffset = 98\n\t// ex.expressionEndOffset = 98\n\t// ex.name = ReferenceError\n\t//\n\t// FIREFOX:\n\t// ex.message = qq is not defined\n\t// ex.fileName = http://...\n\t// ex.lineNumber = 59\n\t// ex.columnNumber = 69\n\t// ex.stack = ...stack trace... (see the example below)\n\t// ex.name = ReferenceError\n\t//\n\t// CHROME:\n\t// ex.message = qq is not defined\n\t// ex.name = ReferenceError\n\t// ex.type = not_defined\n\t// ex.arguments = ['aa']\n\t// ex.stack = ...stack trace...\n\t//\n\t// INTERNET EXPLORER:\n\t// ex.message = ...\n\t// ex.name = ReferenceError\n\t//\n\t// OPERA:\n\t// ex.message = ...message... (see the example below)\n\t// ex.name = ReferenceError\n\t// ex.opera#sourceloc = 11  (pretty much useless, duplicates the info in ex.message)\n\t// ex.stacktrace = n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace'\n\n\t/**\n\t * Computes stack trace information from the stack property.\n\t * Chrome and Gecko use this property.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromStackProp(ex) {\n\t\tif (!ex.stack) {\n\t\t\treturn\n\t\t}\n\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar chrome = /^\\s*at (.*?) ?\\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar gecko = /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\\[native).*?|[^@]*bundle)(?::(\\d+))?(?::(\\d+))?\\s*$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar winjs = /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i\n\n\t\t// Used to additionally parse URL/line/column from eval frames\n\t\tvar isEval\n\t\tvar geckoEval = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i\n\t\tvar chromeEval = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/\n\t\tvar lines = ex.stack.split('\\n')\n\t\tvar stack = []\n\t\tvar submatch\n\t\tvar parts\n\t\tvar element\n\n\t\tfor (var i = 0, j = lines.length; i < j; i += 1) {\n\t\t\tif (chrome.exec(lines[i])) {\n\t\t\t\tparts = chrome.exec(lines[i])\n\t\t\t\tvar isNative = parts[2] && parts[2].indexOf('native') === 0 // start of line\n\t\t\t\tisEval = parts[2] && parts[2].indexOf('eval') === 0 // start of line\n\t\t\t\tsubmatch = chromeEval.exec(parts[2])\n\t\t\t\tif (isEval && submatch) {\n\t\t\t\t\t// throw out eval line/column and use top-most line/column number\n\t\t\t\t\tparts[2] = submatch[1] // url\n\t\t\t\t\tparts[3] = submatch[2] // line\n\t\t\t\t\tparts[4] = submatch[3] // column\n\t\t\t\t}\n\t\t\t\telement = {\n\t\t\t\t\targs: isNative ? [parts[2]] : [],\n\t\t\t\t\tcolumn: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: parts[3] ? +parts[3] : undefined,\n\t\t\t\t\turl: !isNative ? parts[2] : undefined,\n\t\t\t\t}\n\t\t\t} else if (winjs.exec(lines[i])) {\n\t\t\t\tparts = winjs.exec(lines[i])\n\t\t\t\telement = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: +parts[3],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (gecko.exec(lines[i])) {\n\t\t\t\tparts = gecko.exec(lines[i])\n\t\t\t\tisEval = parts[3] && parts[3].indexOf(' > eval') > -1\n\t\t\t\tsubmatch = geckoEval.exec(parts[3])\n\t\t\t\tif (isEval && submatch) {\n\t\t\t\t\t// throw out eval line/column and use top-most line number\n\t\t\t\t\tparts[3] = submatch[1]\n\t\t\t\t\tparts[4] = submatch[2]\n\t\t\t\t\tparts[5] = undefined // no column when eval\n\t\t\t\t} else if (i === 0 && !parts[5] && !isUndefined(ex.columnNumber)) {\n\t\t\t\t\t// FireFox uses this awesome columnNumber property for its top frame\n\t\t\t\t\t// Also note, Firefox's column number is 0-based and everything else expects 1-based,\n\t\t\t\t\t// so adding 1\n\t\t\t\t\t// NOTE: this hack doesn't work if top-most frame is eval\n\t\t\t\t\tstack[0].column = ex.columnNumber + 1\n\t\t\t\t}\n\t\t\t\telement = {\n\t\t\t\t\targs: parts[2] ? parts[2].split(',') : [],\n\t\t\t\t\tcolumn: parts[5] ? +parts[5] : undefined,\n\t\t\t\t\tfunc: parts[1] || UNKNOWN_FUNCTION,\n\t\t\t\t\tline: parts[4] ? +parts[4] : undefined,\n\t\t\t\t\turl: parts[3],\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tif (!element.func && element.line) {\n\t\t\t\telement.func = UNKNOWN_FUNCTION\n\t\t\t}\n\t\t\tstack.push(element)\n\t\t}\n\n\t\tif (!stack.length) {\n\t\t\treturn\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * Computes stack trace information from the stacktrace property.\n\t * Opera 10+ uses this property.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromStacktraceProp(ex) {\n\t\t// Access and store the stacktrace property before doing ANYTHING\n\t\t// else to it because Opera is not very good at providing it\n\t\t// reliably in other circumstances.\n\t\tvar stacktrace = ex.stacktrace\n\t\tif (!stacktrace) {\n\t\t\treturn\n\t\t}\n\n\t\tvar opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i\n\t\t// tslint:disable-next-line max-line-length\n\t\tvar opera11Regex = / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^\\)]+))\\((.*)\\))? in (.*):\\s*$/i\n\t\tvar lines = stacktrace.split('\\n')\n\t\tvar stack = []\n\t\tvar parts\n\n\t\tfor (var line = 0; line < lines.length; line += 2) {\n\t\t\tvar element\n\t\t\tif (opera10Regex.exec(lines[line])) {\n\t\t\t\tparts = opera10Regex.exec(lines[line])\n\t\t\t\telement = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: parts[3],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (opera11Regex.exec(lines[line])) {\n\t\t\t\tparts = opera11Regex.exec(lines[line])\n\t\t\t\telement = {\n\t\t\t\t\targs: parts[5] ? parts[5].split(',') : [],\n\t\t\t\t\tcolumn: +parts[2],\n\t\t\t\t\tfunc: parts[3] || parts[4],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[6],\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (element) {\n\t\t\t\tif (!element.func && element.line) {\n\t\t\t\t\telement.func = UNKNOWN_FUNCTION\n\t\t\t\t}\n\t\t\t\telement.context = [lines[line + 1]]\n\n\t\t\t\tstack.push(element)\n\t\t\t}\n\t\t}\n\n\t\tif (!stack.length) {\n\t\t\treturn\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * NOT TESTED.\n\t * Computes stack trace information from an error message that includes\n\t * the stack trace.\n\t * Opera 9 and earlier use this method if the option to show stack\n\t * traces is turned on in opera:config.\n\t * @param {Error} ex\n\t * @return {?StackTrace} Stack information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceFromOperaMultiLineMessage(ex) {\n\t\t// TODO: Clean this function up\n\t\t// Opera includes a stack trace into the exception message. An example is:\n\t\t//\n\t\t// Statement on line 3: Undefined variable: undefinedFunc\n\t\t// Backtrace:\n\t\t//   Line 3 of linked script file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.js:\n\t\t//   In function zzz\n\t\t//         undefinedFunc(a);\n\t\t//   Line 7 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n\t\t//   In function yyy\n\t\t//           zzz(x, y, z);\n\t\t//   Line 3 of inline#1 script in file://localhost/Users/andreyvit/Projects/TraceKit/javascript-client/sample.html:\n\t\t//   In function xxx\n\t\t//           yyy(a, a, a);\n\t\t//   Line 1 of function script\n\t\t//     try { xxx('hi'); return false; } catch(ex) { report(ex); }\n\t\t//   ...\n\n\t\tvar lines = ex.message.split('\\n')\n\t\tif (lines.length < 4) {\n\t\t\treturn\n\t\t}\n\n\t\tvar lineRE1 = /^\\s*Line (\\d+) of linked script ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i\n\t\tvar lineRE2 = /^\\s*Line (\\d+) of inline#(\\d+) script in ((?:file|https?|blob)\\S+)(?:: in function (\\S+))?\\s*$/i\n\t\tvar lineRE3 = /^\\s*Line (\\d+) of function script\\s*$/i\n\t\tvar stack = []\n\t\tvar scripts =\n\t\t\twindow &&\n\t\t\twindow.document &&\n\t\t\twindow.document.getElementsByTagName('script')\n\t\tvar inlineScriptBlocks = []\n\t\tvar parts\n\n\t\tfor (var s in scripts) {\n\t\t\tif (has(scripts, s) && !scripts[s].src) {\n\t\t\t\tinlineScriptBlocks.push(scripts[s])\n\t\t\t}\n\t\t}\n\n\t\tfor (var line = 2; line < lines.length; line += 2) {\n\t\t\tvar item\n\t\t\tif (lineRE1.exec(lines[line])) {\n\t\t\t\tparts = lineRE1.exec(lines[line])\n\t\t\t\titem = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: parts[3],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[2],\n\t\t\t\t}\n\t\t\t} else if (lineRE2.exec(lines[line])) {\n\t\t\t\tparts = lineRE2.exec(lines[line])\n\t\t\t\titem = {\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined, // TODO: Check to see if inline#1 (+parts[2]) points to the script number or column number.\n\t\t\t\t\tfunc: parts[4],\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t\turl: parts[3],\n\t\t\t\t}\n\t\t\t} else if (lineRE3.exec(lines[line])) {\n\t\t\t\tparts = lineRE3.exec(lines[line])\n\t\t\t\tvar url = window.location.href.replace(/#.*$/, '')\n\t\t\t\titem = {\n\t\t\t\t\turl,\n\t\t\t\t\targs: [],\n\t\t\t\t\tcolumn: undefined,\n\t\t\t\t\tfunc: '',\n\t\t\t\t\tline: +parts[1],\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (item) {\n\t\t\t\tif (!item.func) {\n\t\t\t\t\titem.func = UNKNOWN_FUNCTION\n\t\t\t\t}\n\t\t\t\titem.context = [lines[line + 1]]\n\t\t\t\tstack.push(item)\n\t\t\t}\n\t\t}\n\t\tif (!stack.length) {\n\t\t\treturn // could not parse multiline exception message as Opera stack trace\n\t\t}\n\n\t\treturn {\n\t\t\tstack,\n\t\t\tmessage: lines[0],\n\t\t\tname: ex.name,\n\t\t}\n\t}\n\n\t/**\n\t * Adds information about the first frame to incompvare stack traces.\n\t * Safari and IE require this to get compvare data on the first frame.\n\t * @param {StackTrace} stackInfo Stack trace information from\n\t * one of the compute* methods.\n\t * @param {string=} url The URL of the script that caused an error.\n\t * @param {(number|string)=} lineNo The line number of the script that\n\t * caused an error.\n\t * @param {string=} message The error generated by the browser, which\n\t * hopefully contains the name of the object that caused the error.\n\t * @return {boolean} Whether or not the stack information was\n\t * augmented.\n\t * @memberof computeStackTrace\n\t */\n\tfunction augmentStackTraceWithInitialElement(\n\t\tstackInfo,\n\t\turl,\n\t\tlineNo,\n\t\tmessage,\n\t) {\n\t\tvar initial = {\n\t\t\turl,\n\t\t\tline: lineNo ? +lineNo : undefined,\n\t\t}\n\n\t\tif (initial.url && initial.line) {\n\t\t\tstackInfo.incompvare = false\n\n\t\t\tvar stack = stackInfo.stack\n\t\t\tif (stack.length > 0) {\n\t\t\t\tif (stack[0].url === initial.url) {\n\t\t\t\t\tif (stack[0].line === initial.line) {\n\t\t\t\t\t\treturn false // already in stack trace\n\t\t\t\t\t}\n\t\t\t\t\tif (!stack[0].line && stack[0].func === initial.func) {\n\t\t\t\t\t\tstack[0].line = initial.line\n\t\t\t\t\t\tstack[0].context = initial.context\n\t\t\t\t\t\treturn false\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstack.unshift(initial)\n\t\t\tstackInfo.partial = true\n\t\t\treturn true\n\t\t}\n\t\tstackInfo.incompvare = true\n\n\t\treturn false\n\t}\n\n\t/**\n\t * Computes stack trace information by walking the arguments.caller\n\t * chain at the time the exception occurred. This will cause earlier\n\t * frames to be missed but is the only way to get any stack trace in\n\t * Safari and IE. The top frame is restored by\n\t * {@link augmentStackTraceWithInitialElement}.\n\t * @param {Error} ex\n\t * @param {number} depth\n\t * @return {StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceByWalkingCallerChain(ex, depth) {\n\t\tvar functionName = /function\\s+([_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(/i\n\t\tvar stack = []\n\t\tvar funcs = {}\n\t\tvar recursion = false\n\t\tvar parts\n\t\tvar item\n\n\t\tfor (\n\t\t\tvar curr = computeStackTraceByWalkingCallerChain.caller;\n\t\t\tcurr && !recursion;\n\t\t\tcurr = curr.caller\n\t\t) {\n\t\t\tif (curr === computeStackTrace || curr === report) {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\titem = {\n\t\t\t\targs: [],\n\t\t\t\tcolumn: undefined,\n\t\t\t\tfunc: UNKNOWN_FUNCTION,\n\t\t\t\tline: undefined,\n\t\t\t\turl: undefined,\n\t\t\t}\n\n\t\t\tparts = functionName.exec(curr.toString())\n\t\t\tif (curr.name) {\n\t\t\t\titem.func = curr.name\n\t\t\t} else if (parts) {\n\t\t\t\titem.func = parts[1]\n\t\t\t}\n\n\t\t\tif (typeof item.func === 'undefined') {\n\t\t\t\titem.func = parts\n\t\t\t\t\t? parts.input.substring(0, parts.input.indexOf('{'))\n\t\t\t\t\t: undefined\n\t\t\t}\n\n\t\t\tif (funcs[curr + '']) {\n\t\t\t\trecursion = true\n\t\t\t} else {\n\t\t\t\tfuncs[curr + ''] = true\n\t\t\t}\n\n\t\t\tstack.push(item)\n\t\t}\n\n\t\tif (depth) {\n\t\t\tstack.splice(0, depth)\n\t\t}\n\n\t\tvar result = {\n\t\t\tstack,\n\t\t\tmessage: ex.message,\n\t\t\tname: ex.name,\n\t\t}\n\t\taugmentStackTraceWithInitialElement(\n\t\t\tresult,\n\t\t\tex.sourceURL || ex.fileName,\n\t\t\tex.line || ex.lineNumber,\n\t\t\tex.message || ex.description,\n\t\t)\n\t\treturn result\n\t}\n\n\t/**\n\t * Computes a stack trace for an exception.\n\t * @param {Error} ex\n\t * @param {(string|number)=} depth\n\t * @memberof computeStackTrace\n\t */\n\tfunction doComputeStackTrace(ex, depth) {\n\t\tvar stack\n\t\tvar normalizedDepth = depth === undefined ? 0 : +depth\n\n\t\ttry {\n\t\t\t// This must be tried first because Opera 10 *destroys*\n\t\t\t// its stacktrace property if you try to access the stack\n\t\t\t// property first!!\n\t\t\tstack = computeStackTraceFromStacktraceProp(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceFromStackProp(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceFromOperaMultiLineMessage(ex)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tstack = computeStackTraceByWalkingCallerChain(ex, normalizedDepth + 1)\n\t\t\tif (stack) {\n\t\t\t\treturn stack\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tif (debug) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessage: extractMessage(ex),\n\t\t\tname: ex.name,\n\t\t\tstack: [],\n\t\t}\n\t}\n\n\t/**\n\t * Logs a stacktrace starting from the previous call and working down.\n\t * @param {(number|string)=} depth How many frames deep to trace.\n\t * @return {StackTrace} Stack trace information.\n\t * @memberof computeStackTrace\n\t */\n\tfunction computeStackTraceOfCaller(depth) {\n\t\tvar currentDepth = (depth === undefined ? 0 : +depth) + 1 // \"+ 1\" because \"ofCaller\" should drop one frame\n\t\ttry {\n\t\t\tthrow new Error()\n\t\t} catch (ex) {\n\t\t\treturn computeStackTrace(ex, currentDepth + 1)\n\t\t}\n\t}\n\n\tdoComputeStackTrace.augmentStackTraceWithInitialElement = augmentStackTraceWithInitialElement\n\tdoComputeStackTrace.computeStackTraceFromStackProp = computeStackTraceFromStackProp\n\tdoComputeStackTrace.ofCaller = computeStackTraceOfCaller\n\n\treturn doComputeStackTrace\n})()\nvar ERROR_TYPES_RE = /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/\nfunction extractMessage(ex) {\n\tconst message = ex && ex.message\n\t// console.log('message',message)\n\tif (!message) {\n\t\treturn 'No error message'\n\t}\n\tif (message.error && typeof message.error.message === 'string') {\n\t\treturn message.error.message\n\t}\n\n\treturn message\n}\n","import { sdk } from './sdk'\nimport { now } from '../helper/utils'\nimport { RequestType } from '../helper/enums'\nvar xhrProxySingleton\nvar beforeSendCallbacks = []\nvar onRequestCompleteCallbacks = []\nvar originalXhrRequest\nexport function startXhrProxy() {\n\tif (!xhrProxySingleton) {\n\t\tproxyXhr()\n\t\txhrProxySingleton = {\n\t\t\tbeforeSend: function (callback) {\n\t\t\t\tbeforeSendCallbacks.push(callback)\n\t\t\t},\n\t\t\tonRequestComplete: function (callback) {\n\t\t\t\tonRequestCompleteCallbacks.push(callback)\n\t\t\t},\n\t\t}\n\t}\n\treturn xhrProxySingleton\n}\n\nexport function resetXhrProxy() {\n\tif (xhrProxySingleton) {\n\t\txhrProxySingleton = undefined\n\t\tbeforeSendCallbacks.splice(0, beforeSendCallbacks.length)\n\t\tonRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length)\n\t\tsdk.request = originalXhrRequest\n\t}\n}\n\nfunction proxyXhr() {\n\toriginalXhrRequest = sdk.request\n\tsdk.request = function () {\n\t\tvar _this = this\n\t\tvar dataflux_xhr = {\n\t\t\tmethod: arguments[0].method || 'GET',\n\t\t\tstartTime: 0,\n\t\t\turl: arguments[0].url,\n\t\t\ttype: RequestType.XHR,\n\t\t\tresponseType: arguments[0].responseType || 'text',\n\t\t}\n\t\tdataflux_xhr.startTime = now()\n\n\t\tvar originalSuccess = arguments[0].success\n\n\t\targuments[0].success = function () {\n\t\t\treportXhr(arguments[0])\n\n\t\t\tif (originalSuccess) {\n\t\t\t\toriginalSuccess.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar originalFail = arguments[0].fail\n\t\targuments[0].fail = function () {\n\t\t\treportXhr(arguments[0])\n\t\t\tif (originalFail) {\n\t\t\t\toriginalFail.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar hasBeenReported = false\n\t\tvar reportXhr = function (res) {\n\t\t\tif (hasBeenReported) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\thasBeenReported = true\n\t\t\tdataflux_xhr.duration = now() - dataflux_xhr.startTime\n\t\t\tdataflux_xhr.response = JSON.stringify(res.data)\n\t\t\tdataflux_xhr.header = res.header || {}\n\t\t\tdataflux_xhr.profile = res.profile\n\t\t\tdataflux_xhr.status = res.statusCode || res.status || 0\n\t\t\tonRequestCompleteCallbacks.forEach(function (callback) {\n\t\t\t\tcallback(dataflux_xhr)\n\t\t\t})\n\t\t}\n\t\tbeforeSendCallbacks.forEach(function (callback) {\n\t\t\tcallback(dataflux_xhr)\n\t\t})\n\t\treturn originalXhrRequest.apply(this, arguments)\n\t}\n}\n","export class Observable {\n\tconstructor() {\n\t\tthis.observers = []\n\t}\n\tsubscribe(f) {\n\t\tthis.observers.push(f)\n\t}\n\tnotify(data) {\n\t\tthis.observers.forEach(function (observer) {\n\t\t\tobserver(data)\n\t\t})\n\t}\n}\n","import { sdk } from './sdk'\nimport { now } from '../helper/utils'\nimport { RequestType } from '../helper/enums'\nvar downloadProxySingleton\nvar beforeSendCallbacks = []\nvar onRequestCompleteCallbacks = []\nvar originalDownloadRequest\nexport function startDownloadProxy() {\n\tif (!downloadProxySingleton) {\n\t\tproxyDownload()\n\t\tdownloadProxySingleton = {\n\t\t\tbeforeSend: function (callback) {\n\t\t\t\tbeforeSendCallbacks.push(callback)\n\t\t\t},\n\t\t\tonRequestComplete: function (callback) {\n\t\t\t\tonRequestCompleteCallbacks.push(callback)\n\t\t\t},\n\t\t}\n\t}\n\treturn downloadProxySingleton\n}\n\nexport function resetDownloadProxy() {\n\tif (downloadProxySingleton) {\n\t\tdownloadProxySingleton = undefined\n\t\tbeforeSendCallbacks.splice(0, beforeSendCallbacks.length)\n\t\tonRequestCompleteCallbacks.splice(0, onRequestCompleteCallbacks.length)\n\t\tsdk.downloadFile = originalDownloadRequest\n\t}\n}\n\nfunction proxyDownload() {\n\toriginalDownloadRequest = sdk.downloadFile\n\tsdk.downloadFile = function () {\n\t\tvar _this = this\n\t\tvar dataflux_xhr = {\n\t\t\tmethod: 'GET',\n\t\t\tstartTime: 0,\n\t\t\turl: arguments[0].url,\n\t\t\ttype: RequestType.DOWNLOAD,\n\t\t\tresponseType: 'file',\n\t\t}\n\t\tdataflux_xhr.startTime = now()\n\n\t\tvar originalSuccess = arguments[0].success\n\n\t\targuments[0].success = function () {\n\t\t\treportXhr(arguments[0])\n\n\t\t\tif (originalSuccess) {\n\t\t\t\toriginalSuccess.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar originalFail = arguments[0].fail\n\t\targuments[0].fail = function () {\n\t\t\treportXhr(arguments[0])\n\t\t\tif (originalFail) {\n\t\t\t\toriginalFail.apply(_this, arguments)\n\t\t\t}\n\t\t}\n\t\tvar hasBeenReported = false\n\t\tvar reportXhr = function (res) {\n\t\t\tif (hasBeenReported) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\thasBeenReported = true\n\t\t\tdataflux_xhr.duration = now() - dataflux_xhr.startTime\n\t\t\tdataflux_xhr.response = JSON.stringify({\n\t\t\t\tfilePath: res.filePath,\n\t\t\t\ttempFilePath: res.tempFilePath,\n\t\t\t})\n\t\t\tdataflux_xhr.header = res.header || {}\n\t\t\tdataflux_xhr.profile = res.profile\n\t\t\tdataflux_xhr.status = res.statusCode || res.status || 0\n\t\t\tonRequestCompleteCallbacks.forEach(function (callback) {\n\t\t\t\tcallback(dataflux_xhr)\n\t\t\t})\n\t\t}\n\t\tbeforeSendCallbacks.forEach(function (callback) {\n\t\t\tcallback(dataflux_xhr)\n\t\t})\n\t\treturn originalDownloadRequest.apply(this, arguments)\n\t}\n}\n","import { toArray, now } from '../helper/utils'\nimport { ONE_MINUTE, RequestType } from '../helper/enums'\nimport {\n\tErrorSource,\n\tformatUnknownError,\n\ttoStackTraceString,\n} from './errorTools'\nimport { computeStackTrace, report } from '../helper/tracekit'\nimport { Observable } from './observable'\nimport { isIntakeRequest } from './configuration'\nimport { resetXhrProxy, startXhrProxy } from './xhrProxy'\nimport { resetDownloadProxy, startDownloadProxy } from './downloadProxy'\nvar originalConsoleError\n\nexport function startConsoleTracking(errorObservable) {\n\toriginalConsoleError = console.error\n\tconsole.error = function () {\n\t\toriginalConsoleError.apply(console, arguments)\n\t\tvar args = toArray(arguments)\n\t\tvar message = []\n\t\targs.concat(['console error:']).forEach(function (para) {\n\t\t\tmessage.push(formatConsoleParameters(para))\n\t\t})\n\n\t\terrorObservable.notify({\n\t\t\tmessage: message.join(' '),\n\t\t\tsource: ErrorSource.CONSOLE,\n\t\t\tstartTime: now(),\n\t\t})\n\t}\n}\n\nexport function stopConsoleTracking() {\n\tconsole.error = originalConsoleError\n}\n\nfunction formatConsoleParameters(param) {\n\tif (typeof param === 'string') {\n\t\treturn param\n\t}\n\tif (param instanceof Error) {\n\t\treturn toStackTraceString(computeStackTrace(param))\n\t}\n\treturn JSON.stringify(param, undefined, 2)\n}\nexport function filterErrors(configuration, errorObservable) {\n\tvar errorCount = 0\n\tvar filteredErrorObservable = new Observable()\n\terrorObservable.subscribe(function (error) {\n\t\tif (errorCount < configuration.maxErrorsByMinute) {\n\t\t\terrorCount += 1\n\t\t\tfilteredErrorObservable.notify(error)\n\t\t} else if (errorCount === configuration.maxErrorsByMinute) {\n\t\t\terrorCount += 1\n\t\t\tfilteredErrorObservable.notify({\n\t\t\t\tmessage:\n\t\t\t\t\t'Reached max number of errors by minute: ' +\n\t\t\t\t\tconfiguration.maxErrorsByMinute,\n\t\t\t\tsource: ErrorSource.AGENT,\n\t\t\t\tstartTime: now(),\n\t\t\t})\n\t\t}\n\t})\n\tsetInterval(function () {\n\t\terrorCount = 0\n\t}, ONE_MINUTE)\n\treturn filteredErrorObservable\n}\nvar traceKitReportHandler\n\nexport function startRuntimeErrorTracking(errorObservable) {\n\ttraceKitReportHandler = function (stackTrace, _, errorObject) {\n\t\tvar error = formatUnknownError(stackTrace, errorObject, 'Uncaught')\n\t\terrorObservable.notify({\n\t\t\tmessage: error.message,\n\t\t\tstack: error.stack,\n\t\t\ttype: error.type,\n\t\t\tsource: ErrorSource.SOURCE,\n\t\t\tstartTime: now(),\n\t\t})\n\t}\n\treport.subscribe(traceKitReportHandler)\n}\n\nexport function stopRuntimeErrorTracking() {\n\treport.unsubscribe(traceKitReportHandler)\n}\nvar filteredErrorsObservable\n\nexport function startAutomaticErrorCollection(configuration) {\n\tif (!filteredErrorsObservable) {\n\t\tvar errorObservable = new Observable()\n\t\ttrackNetworkError(configuration, errorObservable)\n\t\tstartConsoleTracking(errorObservable)\n\t\tstartRuntimeErrorTracking(errorObservable)\n\t\tfilteredErrorsObservable = filterErrors(configuration, errorObservable)\n\t}\n\treturn filteredErrorsObservable\n}\n\nexport function trackNetworkError(configuration, errorObservable) {\n\tstartXhrProxy().onRequestComplete(function (context) {\n\t\treturn handleCompleteRequest(context.type, context)\n\t})\n\tstartDownloadProxy().onRequestComplete(function (context) {\n\t\treturn handleCompleteRequest(context.type, context)\n\t})\n\n\tfunction handleCompleteRequest(type, request) {\n\t\tif (\n\t\t\t!isIntakeRequest(request.url, configuration) &&\n\t\t\t(isRejected(request) || isServerError(request))\n\t\t) {\n\t\t\terrorObservable.notify({\n\t\t\t\tmessage: format(type) + 'error' + request.method + ' ' + request.url,\n\t\t\t\tresource: {\n\t\t\t\t\tmethod: request.method,\n\t\t\t\t\tstatusCode: request.status,\n\t\t\t\t\turl: request.url,\n\t\t\t\t},\n\t\t\t\ttype: ErrorSource.NETWORK,\n\t\t\t\tsource: ErrorSource.NETWORK,\n\t\t\t\tstack:\n\t\t\t\t\ttruncateResponse(request.response, configuration) || 'Failed to load',\n\t\t\t\tstartTime: request.startTime,\n\t\t\t})\n\t\t}\n\t}\n\n\treturn {\n\t\tstop: function () {\n\t\t\tresetXhrProxy()\n\t\t\tresetDownloadProxy()\n\t\t},\n\t}\n}\nfunction isRejected(request) {\n\treturn request.status === 0 && request.responseType !== 'opaque'\n}\n\nfunction isServerError(request) {\n\treturn request.status >= 500\n}\n\nfunction truncateResponse(response, configuration) {\n\tif (\n\t\tresponse &&\n\t\tresponse.length > configuration.requestErrorResponseLengthLimit\n\t) {\n\t\treturn (\n\t\t\tresponse.substring(0, configuration.requestErrorResponseLengthLimit) +\n\t\t\t'...'\n\t\t)\n\t}\n\treturn response\n}\n\nfunction format(type) {\n\tif (RequestType.XHR === type) {\n\t\treturn 'XHR'\n\t}\n\treturn RequestType.DOWNLOAD\n}\n","import { startAutomaticErrorCollection } from '../../core/errorCollection'\nimport { RumEventType } from '../../helper/enums'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport {\n\turlParse,\n\treplaceNumberCharByPath,\n\tgetStatusGroup,\n} from '../../helper/utils'\nexport function startErrorCollection(lifeCycle, configuration) {\n\treturn doStartErrorCollection(\n\t\tlifeCycle,\n\t\tconfiguration,\n\t\tstartAutomaticErrorCollection(configuration),\n\t)\n}\n\nexport function doStartErrorCollection(lifeCycle, configuration, observable) {\n\tobservable.subscribe(function (error) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessError(error),\n\t\t)\n\t})\n}\n\nfunction processError(error) {\n\tvar resource = error.resource\n\tif (resource) {\n\t\tvar urlObj = urlParse(error.resource.url).getParse()\n\t\tresource = {\n\t\t\tmethod: error.resource.method,\n\t\t\tstatus: error.resource.statusCode,\n\t\t\tstatusGroup: getStatusGroup(error.resource.statusCode),\n\t\t\turl: error.resource.url,\n\t\t\turlHost: urlObj.Host,\n\t\t\turlPath: urlObj.Path,\n\t\t\turlPathGroup: replaceNumberCharByPath(urlObj.Path),\n\t\t}\n\t}\n\tvar rawRumEvent = {\n\t\tdate: error.startTime,\n\t\terror: {\n\t\t\tmessage: error.message,\n\t\t\tresource: resource,\n\t\t\tsource: error.source,\n\t\t\tstack: error.stack,\n\t\t\ttype: error.type,\n\t\t\tstarttime: error.startTime,\n\t\t},\n\t\ttype: RumEventType.ERROR,\n\t}\n\treturn {\n\t\trawRumEvent: rawRumEvent,\n\t\tstartTime: error.startTime,\n\t}\n}\n","import { sdk } from '../core/sdk'\nimport { UUID } from '../helper/utils'\nimport { CLIENT_ID_TOKEN } from '../helper/enums'\nclass BaseInfo {\n\tconstructor() {\n\t\tthis.sessionId = UUID()\n\t\tthis.getDeviceInfo()\n\t\tthis.getNetWork()\n\t}\n\tgetDeviceInfo() {\n\t\ttry {\n\t\t\tconst deviceInfo = sdk.getSystemInfoSync()\n\t\t\tvar osInfo = deviceInfo.system.split(' ')\n\t\t\tvar osVersion = osInfo.length > 1 && osInfo[1]\n\t\t\tvar osVersionMajor =\n\t\t\t\tosVersion.split('.').length && osVersion.split('.')[0]\n\t\t\tvar deviceUUid = ''\n\t\t\tif (deviceInfo.host) {\n\t\t\t\tdeviceUUid = deviceInfo.host.appId\n\t\t\t}\n\t\t\tthis.deviceInfo = {\n\t\t\t\tscreenSize: `${deviceInfo.screenWidth}*${deviceInfo.screenHeight} `,\n\t\t\t\tplatform: deviceInfo.platform,\n\t\t\t\tplatformVersion: deviceInfo.version,\n\t\t\t\tosVersion: osVersion,\n\t\t\t\tosVersionMajor: osVersionMajor,\n\t\t\t\tos: osInfo.length > 1 && osInfo[0],\n\t\t\t\tbrand: deviceInfo.brand,\n\t\t\t\tmodel: deviceInfo.model,\n\t\t\t\tframeworkVersion: deviceInfo.SDKVersion,\n\t\t\t\tpixelRatio: deviceInfo.pixelRatio,\n\t\t\t\tdeviceUuid: deviceUUid,\n\t\t\t}\n\t\t} catch (e) {}\n\t}\n\tgetClientID() {\n\t\tvar clienetId = sdk.getStorageSync(CLIENT_ID_TOKEN)\n\t\tif (!clienetId) {\n\t\t\tclienetId = UUID()\n\t\t\tsdk.setStorageSync(CLIENT_ID_TOKEN, clienetId)\n\t\t}\n\t\treturn clienetId\n\t}\n\tgetNetWork() {\n\t\tsdk.getNetworkType({\n\t\t\tsuccess: (e) => {\n\t\t\t\tthis.deviceInfo.network = e.networkType ? e.networkType : 'unknown'\n\t\t\t},\n\t\t})\n\t\tsdk.onNetworkStatusChange((e) => {\n\t\t\tthis.deviceInfo.network = e.networkType ? e.networkType : 'unknown'\n\t\t})\n\t}\n\tgetSessionId() {\n\t\treturn this.sessionId\n\t}\n}\n\nexport default new BaseInfo()\n","import { extend2Lev, withSnakeCaseKeys, performDraw } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { RumEventType } from '../helper/enums'\nimport baseInfo from '../core/baseInfo'\nfunction isTracked(configuration) {\n\treturn performDraw(configuration.sampleRate)\n}\nvar SessionType = {\n\tSYNTHETICS: 'synthetics',\n\tUSER: 'user',\n}\nexport function startRumAssembly(\n\tapplicationId,\n\tconfiguration,\n\tlifeCycle,\n\tparentContexts,\n) {\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\tfunction (data) {\n\t\t\tvar startTime = data.startTime\n\t\t\tvar rawRumEvent = data.rawRumEvent\n\t\t\tvar viewContext = parentContexts.findView(startTime)\n\n\t\t\tvar deviceContext = {\n\t\t\t\tdevice: baseInfo.deviceInfo,\n\t\t\t}\n\t\t\tif (\n\t\t\t\tisTracked(configuration) &&\n\t\t\t\t(viewContext || rawRumEvent.type === RumEventType.APP)\n\t\t\t) {\n\t\t\t\tvar actionContext = parentContexts.findAction(startTime)\n\t\t\t\tvar rumContext = {\n\t\t\t\t\t_dd: {\n\t\t\t\t\t\tsdkName: configuration.sdkName,\n\t\t\t\t\t\tsdkVersion: configuration.sdkVersion,\n\t\t\t\t\t\tenv: configuration.env,\n\t\t\t\t\t\tversion: configuration.version,\n\t\t\t\t\t},\n\t\t\t\t\ttags: configuration.tags,\n\t\t\t\t\tapplication: {\n\t\t\t\t\t\tid: applicationId,\n\t\t\t\t\t},\n\t\t\t\t\tdevice: {},\n\t\t\t\t\tdate: new Date().getTime(),\n\t\t\t\t\tsession: {\n\t\t\t\t\t\tid: baseInfo.getSessionId(),\n\t\t\t\t\t\ttype: SessionType.USER,\n\t\t\t\t\t},\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tuser_id: configuration.user_id || baseInfo.getClientID(),\n\t\t\t\t\t\tis_signin: configuration.user_id ? 'T' : 'F',\n\t\t\t\t\t},\n\t\t\t\t}\n\n\t\t\t\tvar rumEvent = extend2Lev(\n\t\t\t\t\trumContext,\n\t\t\t\t\tdeviceContext,\n\t\t\t\t\tviewContext,\n\t\t\t\t\tactionContext,\n\t\t\t\t\trawRumEvent,\n\t\t\t\t)\n\n\t\t\t\tvar serverRumEvent = withSnakeCaseKeys(rumEvent)\n\t\t\t\t// if (\n\t\t\t\t// \tserverRumEvent.type === 'view' ||\n\t\t\t\t// \tserverRumEvent.type === 'action'\n\t\t\t\t// ) {\n\t\t\t\t// \tconsole.log(serverRumEvent, 'serverRumEvent')\n\t\t\t\t// }\n\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.RUM_EVENT_COLLECTED, serverRumEvent)\n\t\t\t}\n\t\t},\n\t)\n}\n","import { ONE_MINUTE, ONE_HOUR } from '../helper/enums'\nimport { each, now } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nexport var VIEW_CONTEXT_TIME_OUT_DELAY = 4 * ONE_HOUR\nexport var CLEAR_OLD_CONTEXTS_INTERVAL = ONE_MINUTE\n\nexport function startParentContexts(lifeCycle) {\n\tvar currentView\n\tvar currentAction\n\tvar previousViews = []\n\tvar previousActions = []\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.VIEW_CREATED,\n\t\tfunction (currentContext) {\n\t\t\tcurrentView = currentContext\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.VIEW_UPDATED,\n\t\tfunction (currentContext) {\n\t\t\t// A view can be updated after its end.  We have to ensure that the view being updated is the\n\t\t\t// most recently created.\n\t\t\tif (currentView && currentView.id === currentContext.id) {\n\t\t\t\tcurrentView = currentContext\n\t\t\t}\n\t\t},\n\t)\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_ENDED, function (data) {\n\t\tif (currentView) {\n\t\t\tpreviousViews.unshift({\n\t\t\t\tendTime: data.endClocks,\n\t\t\t\tcontext: buildCurrentViewContext(),\n\t\t\t\tstartTime: currentView.startTime,\n\t\t\t})\n\t\t\tcurrentView = undefined\n\t\t}\n\t})\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.AUTO_ACTION_CREATED,\n\t\tfunction (currentContext) {\n\t\t\tcurrentAction = currentContext\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.AUTO_ACTION_COMPLETED,\n\t\tfunction (action) {\n\t\t\tif (currentAction) {\n\t\t\t\tpreviousActions.unshift({\n\t\t\t\t\tcontext: buildCurrentActionContext(),\n\t\t\t\t\tendTime: currentAction.startClocks + action.duration,\n\t\t\t\t\tstartTime: currentAction.startClocks,\n\t\t\t\t})\n\t\t\t}\n\t\t\tcurrentAction = undefined\n\t\t},\n\t)\n\n\tlifeCycle.subscribe(LifeCycleEventType.AUTO_ACTION_DISCARDED, function () {\n\t\tcurrentAction = undefined\n\t})\n\tlifeCycle.subscribe(LifeCycleEventType.SESSION_RENEWED, function () {\n\t\tpreviousViews = []\n\t\tpreviousActions = []\n\t\tcurrentView = undefined\n\t\tcurrentAction = undefined\n\t})\n\tvar clearOldContextsInterval = setInterval(function () {\n\t\tclearOldContexts(previousViews, VIEW_CONTEXT_TIME_OUT_DELAY)\n\t}, CLEAR_OLD_CONTEXTS_INTERVAL)\n\n\tfunction clearOldContexts(previousContexts, timeOutDelay) {\n\t\tvar oldTimeThreshold = now() - timeOutDelay\n\t\twhile (\n\t\t\tpreviousContexts.length > 0 &&\n\t\t\tpreviousContexts[previousContexts.length - 1].startTime < oldTimeThreshold\n\t\t) {\n\t\t\tpreviousContexts.pop()\n\t\t}\n\t}\n\tfunction buildCurrentActionContext() {\n\t\treturn { userAction: { id: currentAction.id } }\n\t}\n\tfunction buildCurrentViewContext() {\n\t\treturn {\n\t\t\tpage: {\n\t\t\t\tid: currentView.id,\n\t\t\t\treferer:\n\t\t\t\t\t(previousViews.length &&\n\t\t\t\t\t\tpreviousViews[previousViews.length - 1].context.page.route) ||\n\t\t\t\t\tundefined,\n\t\t\t\troute: currentView.route,\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction findContext(\n\t\tbuildContext,\n\t\tpreviousContexts,\n\t\tcurrentContext,\n\t\tstartTime,\n\t) {\n\t\tif (startTime === undefined) {\n\t\t\treturn currentContext ? buildContext() : undefined\n\t\t}\n\t\tif (currentContext && startTime >= currentContext.startTime) {\n\t\t\treturn buildContext()\n\t\t}\n\t\tvar flag = undefined\n\t\teach(previousContexts, function (previousContext) {\n\t\t\tif (startTime > previousContext.endTime) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tif (startTime >= previousContext.startTime) {\n\t\t\t\tflag = previousContext.context\n\t\t\t\treturn false\n\t\t\t}\n\t\t})\n\n\t\treturn flag\n\t}\n\n\tvar parentContexts = {\n\t\tfindView: function (startTime) {\n\t\t\treturn findContext(\n\t\t\t\tbuildCurrentViewContext,\n\t\t\t\tpreviousViews,\n\t\t\t\tcurrentView,\n\t\t\t\tstartTime,\n\t\t\t)\n\t\t},\n\t\tfindAction: function (startTime) {\n\t\t\treturn findContext(\n\t\t\t\tbuildCurrentActionContext,\n\t\t\t\tpreviousActions,\n\t\t\t\tcurrentAction,\n\t\t\t\tstartTime,\n\t\t\t)\n\t\t},\n\n\t\tstop: function () {\n\t\t\tclearInterval(clearOldContextsInterval)\n\t\t},\n\t}\n\treturn parentContexts\n}\n","import { RumEventType } from '../helper/enums'\n// 需要用双引号将字符串类型的field value括起来， 这里有数组标示[string, path]\nexport var commonTags = {\n\tsdk_name: '_dd.sdk_name',\n\tsdk_version: '_dd.sdk_version',\n\tapp_id: 'application.id',\n\tenv: '_dd.env',\n\tversion: '_dd.version',\n\tuserid: 'user.user_id',\n\tsession_id: 'session.id',\n\tsession_type: 'session.type',\n\tis_signin: 'user.is_signin',\n\tdevice: 'device.brand',\n\tmodel: 'device.model',\n\tdevice_uuid: 'device.device_uuid',\n\tos: 'device.os',\n\tos_version: 'device.os_version',\n\tos_version_major: 'device.os_version_major',\n\tscreen_size: 'device.screen_size',\n\tnetwork_type: 'device.network_type',\n\tplatform: 'device.platform',\n\tplatform_version: 'device.platform_version',\n\tapp_framework_version: 'device.framework_version',\n\tview_id: 'page.id',\n\tview_name: 'page.route',\n\tview_referer: 'page.referer',\n}\nexport var dataMap = {\n\tview: {\n\t\ttype: RumEventType.VIEW,\n\t\ttags: {\n\t\t\tview_apdex_level: 'page.apdex_level',\n\t\t\tis_active: 'page.is_active',\n\t\t},\n\t\tfields: {\n\t\t\tpage_fmp: 'page.fmp',\n\t\t\tfirst_paint_time: 'page.fpt',\n\t\t\tloading_time: 'page.loading_time',\n\t\t\tonload_to_onshow: 'page.onload2onshow',\n\t\t\tonshow_to_onready: 'page.onshow2onready',\n\t\t\ttime_spent: 'page.time_spent',\n\t\t\tview_error_count: 'page.error.count',\n\t\t\tview_resource_count: 'page.error.count',\n\t\t\tview_long_task_count: 'page.long_task.count',\n\t\t\tview_action_count: 'page.action.count',\n\t\t\tview_setdata_count: 'page.setdata.count',\n\t\t},\n\t},\n\tresource: {\n\t\ttype: RumEventType.RESOURCE,\n\t\ttags: {\n\t\t\tresource_type: 'resource.type',\n\t\t\tresource_status: 'resource.status',\n\t\t\tresource_status_group: 'resource.status_group',\n\t\t\tresource_method: 'resource.method',\n\t\t\tresource_url: 'resource.url',\n\t\t\tresource_url_host: 'resource.url_host',\n\t\t\tresource_url_path: 'resource.url_path',\n\t\t\tresource_url_path_group: 'resource.url_path_group',\n\t\t\tresource_url_query: 'resource.url_query',\n\t\t},\n\t\tfields: {\n\t\t\tresource_size: 'resource.size',\n\t\t\tresource_load: 'resource.load',\n\t\t\tresource_dns: 'resource.dns',\n\t\t\tresource_tcp: 'resource.tcp',\n\t\t\tresource_ssl: 'resource.ssl',\n\t\t\tresource_ttfb: 'resource.ttfb',\n\t\t\tresource_trans: 'resource.trans',\n\t\t\tresource_first_byte: 'resource.firstbyte',\n\t\t\tduration: 'resource.duration',\n\t\t},\n\t},\n\terror: {\n\t\ttype: RumEventType.ERROR,\n\t\ttags: {\n\t\t\terror_source: 'error.source',\n\t\t\terror_type: 'error.type',\n\t\t\tresource_url: 'error.resource.url',\n\t\t\tresource_url_host: 'error.resource.url_host',\n\t\t\tresource_url_path: 'error.resource.url_path',\n\t\t\tresource_url_path_group: 'error.resource.url_path_group',\n\t\t\tresource_status: 'error.resource.status',\n\t\t\tresource_status_group: 'error.resource.status_group',\n\t\t\tresource_method: 'error.resource.method',\n\t\t},\n\t\tfields: {\n\t\t\terror_message: ['string', 'error.message'],\n\t\t\terror_stack: ['string', 'error.stack'],\n\t\t},\n\t},\n\tlong_task: {\n\t\ttype: RumEventType.LONG_TASK,\n\t\ttags: {},\n\t\tfields: {\n\t\t\tduration: 'long_task.duration',\n\t\t},\n\t},\n\taction: {\n\t\ttype: RumEventType.ACTION,\n\t\ttags: {\n\t\t\taction_id: 'action.id',\n\t\t\taction_name: 'action.target.name',\n\t\t\taction_type: 'action.type',\n\t\t},\n\t\tfields: {\n\t\t\tduration: 'action.loading_time',\n\t\t\taction_error_count: 'action.error.count',\n\t\t\taction_resource_count: 'action.resource.count',\n\t\t\taction_long_task_count: 'action.long_task.count',\n\t\t},\n\t},\n\tapp: {\n\t\talias_key: 'action', // metrc 别名,\n\t\ttype: RumEventType.APP,\n\t\ttags: {\n\t\t\taction_id: 'app.id',\n\t\t\taction_name: 'app.name',\n\t\t\taction_type: 'app.type',\n\t\t},\n\t\tfields: {\n\t\t\tduration: 'app.duration',\n\t\t},\n\t},\n}\n","import {\n\tfindByPath,\n\tescapeRowData,\n\tisNumber,\n\teach,\n\tisString,\n\tvalues,\n\textend,\n} from '../helper/utils'\nimport { sdk } from '../core/sdk'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { commonTags, dataMap } from './dataMap'\n// https://en.wikipedia.org/wiki/UTF-8\nvar HAS_MULTI_BYTES_CHARACTERS = /[^\\u0000-\\u007F]/\nfunction addBatchPrecision(url) {\n\tif (!url) return url\n\treturn url + (url.indexOf('?') === -1 ? '?' : '&') + 'precision=ms'\n}\nvar httpRequest = function (endpointUrl, bytesLimit) {\n\tthis.endpointUrl = endpointUrl\n\tthis.bytesLimit = bytesLimit\n}\nhttpRequest.prototype = {\n\tsend: function (data) {\n\t\tvar url = addBatchPrecision(this.endpointUrl)\n\t\tsdk.request({\n\t\t\tmethod: 'POST',\n\t\t\theader: {\n\t\t\t\t'content-type': 'text/plain;charset=UTF-8',\n\t\t\t},\n\t\t\turl,\n\t\t\tdata,\n\t\t})\n\t},\n}\n\nexport var HttpRequest = httpRequest\n\nfunction batch(\n\trequest,\n\tmaxSize,\n\tbytesLimit,\n\tmaxMessageSize,\n\tflushTimeout,\n\tlifeCycle,\n) {\n\tthis.request = request\n\tthis.maxSize = maxSize\n\tthis.bytesLimit = bytesLimit\n\tthis.maxMessageSize = maxMessageSize\n\tthis.flushTimeout = flushTimeout\n\tthis.lifeCycle = lifeCycle\n\tthis.flushOnVisibilityHidden()\n\tthis.flushPeriodically()\n}\nbatch.prototype = {\n\tpushOnlyBuffer: [],\n\tupsertBuffer: {},\n\tbufferBytesSize: 0,\n\tbufferMessageCount: 0,\n\tadd: function (message) {\n\t\tthis.addOrUpdate(message)\n\t},\n\n\tupsert: function (message, key) {\n\t\tthis.addOrUpdate(message, key)\n\t},\n\n\tflush: function () {\n\t\tif (this.bufferMessageCount !== 0) {\n\t\t\tvar messages = this.pushOnlyBuffer.concat(values(this.upsertBuffer))\n\t\t\tthis.request.send(messages.join('\\n'), this.bufferBytesSize)\n\t\t\tthis.pushOnlyBuffer = []\n\t\t\tthis.upsertBuffer = {}\n\t\t\tthis.bufferBytesSize = 0\n\t\t\tthis.bufferMessageCount = 0\n\t\t}\n\t},\n\n\tprocessSendData: function (message) {\n\t\t// var data = safeJSONParse(message)\n\t\tif (!message || !message.type) return ''\n\t\tvar rowStr = ''\n\t\tvar hasFileds = false\n\t\teach(dataMap, function (value, key) {\n\t\t\tif (value.type === message.type) {\n\t\t\t\t// 做一下别名处理\n\t\t\t\tif (value.alias_key) {\n\t\t\t\t\trowStr += value.alias_key + ','\n\t\t\t\t} else {\n\t\t\t\t\trowStr += key + ','\n\t\t\t\t}\n\n\t\t\t\tvar tagsStr = []\n\t\t\t\tvar tags = extend({}, commonTags, value.tags)\n\t\t\t\teach(tags, function (value_path, _key) {\n\t\t\t\t\tvar _value = findByPath(message, value_path)\n\t\t\t\t\tif (_value || isNumber(_value)) {\n\t\t\t\t\t\ttagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (message.tags.length) {\n\t\t\t\t\t// 自定义tag\n\t\t\t\t\teach(message.tags, function (_value, _key) {\n\t\t\t\t\t\tif (_value || isNumber(_value)) {\n\t\t\t\t\t\t\ttagsStr.push(escapeRowData(_key) + '=' + escapeRowData(_value))\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tvar fieldsStr = []\n\t\t\t\teach(value.fields, function (_value, _key) {\n\t\t\t\t\tif (Array.isArray(_value) && _value.length === 2) {\n\t\t\t\t\t\tvar type = _value[0],\n\t\t\t\t\t\t\tvalue_path = _value[1]\n\t\t\t\t\t\tvar _valueData = findByPath(message, value_path)\n\t\t\t\t\t\tif (_valueData || isNumber(_valueData)) {\n\t\t\t\t\t\t\t_valueData =\n\t\t\t\t\t\t\t\ttype === 'string'\n\t\t\t\t\t\t\t\t\t? '\"' +\n\t\t\t\t\t\t\t\t\t  String(_valueData)\n\t\t\t\t\t\t\t\t\t\t\t.replace(/[\\\\]*\"/g, '\"')\n\t\t\t\t\t\t\t\t\t\t\t.replace(/\"/g, '\\\\\"') +\n\t\t\t\t\t\t\t\t\t  '\"'\n\t\t\t\t\t\t\t\t\t: escapeRowData(_valueData)\n\t\t\t\t\t\t\tfieldsStr.push(escapeRowData(_key) + '=' + _valueData)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isString(_value)) {\n\t\t\t\t\t\tvar _valueData = findByPath(message, _value)\n\t\t\t\t\t\tif (_valueData || isNumber(_valueData)) {\n\t\t\t\t\t\t\t_valueData = escapeRowData(_valueData)\n\t\t\t\t\t\t\tfieldsStr.push(escapeRowData(_key) + '=' + _valueData)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tif (tagsStr.length) {\n\t\t\t\t\trowStr += tagsStr.join(',')\n\t\t\t\t}\n\t\t\t\tif (fieldsStr.length) {\n\t\t\t\t\trowStr += ' '\n\t\t\t\t\trowStr += fieldsStr.join(',')\n\t\t\t\t\thasFileds = true\n\t\t\t\t}\n\t\t\t\trowStr = rowStr + ' ' + message.date\n\t\t\t}\n\t\t})\n\t\treturn hasFileds ? rowStr : ''\n\t},\n\tsizeInBytes: function (candidate) {\n\t\t// Accurate byte size computations can degrade performances when there is a lot of events to process\n\t\tif (!HAS_MULTI_BYTES_CHARACTERS.test(candidate)) {\n\t\t\treturn candidate.length\n\t\t}\n\t\tvar total = 0,\n\t\t\tcharCode\n\t\t// utf-8编码\n\t\tfor (var i = 0, len = candidate.length; i < len; i++) {\n\t\t\tcharCode = candidate.charCodeAt(i)\n\t\t\tif (charCode <= 0x007f) {\n\t\t\t\ttotal += 1\n\t\t\t} else if (charCode <= 0x07ff) {\n\t\t\t\ttotal += 2\n\t\t\t} else if (charCode <= 0xffff) {\n\t\t\t\ttotal += 3\n\t\t\t} else {\n\t\t\t\ttotal += 4\n\t\t\t}\n\t\t}\n\t\treturn total\n\t},\n\n\taddOrUpdate: function (message, key) {\n\t\tvar process = this.process(message)\n\t\tif (!process.processedMessage || process.processedMessage === '') return\n\t\tif (process.messageBytesSize >= this.maxMessageSize) {\n\t\t\tconsole.warn(\n\t\t\t\t'Discarded a message whose size was bigger than the maximum allowed size' +\n\t\t\t\t\tthis.maxMessageSize +\n\t\t\t\t\t'KB.',\n\t\t\t)\n\t\t\treturn\n\t\t}\n\t\tif (this.hasMessageFor(key)) {\n\t\t\tthis.remove(key)\n\t\t}\n\t\tif (this.willReachedBytesLimitWith(process.messageBytesSize)) {\n\t\t\tthis.flush()\n\t\t}\n\t\tthis.push(process.processedMessage, process.messageBytesSize, key)\n\t\tif (this.isFull()) {\n\t\t\tthis.flush()\n\t\t}\n\t},\n\tprocess: function (message) {\n\t\tvar processedMessage = this.processSendData(message)\n\t\tvar messageBytesSize = this.sizeInBytes(processedMessage)\n\t\treturn {\n\t\t\tprocessedMessage: processedMessage,\n\t\t\tmessageBytesSize: messageBytesSize,\n\t\t}\n\t},\n\n\tpush: function (processedMessage, messageBytesSize, key) {\n\t\tif (this.bufferMessageCount > 0) {\n\t\t\t// \\n separator at serialization\n\t\t\tthis.bufferBytesSize += 1\n\t\t}\n\t\tif (key !== undefined) {\n\t\t\tthis.upsertBuffer[key] = processedMessage\n\t\t} else {\n\t\t\tthis.pushOnlyBuffer.push(processedMessage)\n\t\t}\n\t\tthis.bufferBytesSize += messageBytesSize\n\t\tthis.bufferMessageCount += 1\n\t},\n\n\tremove: function (key) {\n\t\tvar removedMessage = this.upsertBuffer[key]\n\t\tdelete this.upsertBuffer[key]\n\t\tvar messageBytesSize = this.sizeInBytes(removedMessage)\n\t\tthis.bufferBytesSize -= messageBytesSize\n\t\tthis.bufferMessageCount -= 1\n\t\tif (this.bufferMessageCount > 0) {\n\t\t\tthis.bufferBytesSize -= 1\n\t\t}\n\t},\n\n\thasMessageFor: function (key) {\n\t\treturn key !== undefined && this.upsertBuffer[key] !== undefined\n\t},\n\n\twillReachedBytesLimitWith: function (messageBytesSize) {\n\t\t// byte of the separator at the end of the message\n\t\treturn this.bufferBytesSize + messageBytesSize + 1 >= this.bytesLimit\n\t},\n\n\tisFull: function () {\n\t\treturn (\n\t\t\tthis.bufferMessageCount === this.maxSize ||\n\t\t\tthis.bufferBytesSize >= this.bytesLimit\n\t\t)\n\t},\n\n\tflushPeriodically: function () {\n\t\tvar _this = this\n\t\tsetTimeout(function () {\n\t\t\t_this.flush()\n\t\t\t_this.flushPeriodically()\n\t\t}, _this.flushTimeout)\n\t},\n\n\tflushOnVisibilityHidden: function () {\n\t\tvar _this = this\n\t\t/**\n\t\t * With sendBeacon, requests are guaranteed to be successfully sent during document unload\n\t\t */\n\t\t// @ts-ignore this function is not always defined\n\t\tthis.lifeCycle.subscribe(LifeCycleEventType.APP_HIDE, function () {\n\t\t\t_this.flush()\n\t\t})\n\t},\n}\n\nexport var Batch = batch\n","import { LifeCycleEventType } from '../../core/lifeCycle'\nimport { Batch, HttpRequest } from '../../core/transport'\nimport { RumEventType } from '../../helper/enums'\nexport function startRumBatch(configuration, lifeCycle) {\n\tvar batch = makeRumBatch(configuration, lifeCycle)\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.RUM_EVENT_COLLECTED,\n\t\tfunction (serverRumEvent) {\n\t\t\tif (serverRumEvent.type === RumEventType.VIEW) {\n\t\t\t\tbatch.upsert(serverRumEvent, serverRumEvent.page.id)\n\t\t\t} else {\n\t\t\t\tbatch.add(serverRumEvent)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: function () {\n\t\t\tbatch.stop()\n\t\t},\n\t}\n}\n\nfunction makeRumBatch(configuration, lifeCycle) {\n\tvar primaryBatch = createRumBatch(configuration.datakitUrl, lifeCycle)\n\n\tfunction createRumBatch(endpointUrl, lifeCycle) {\n\t\treturn new Batch(\n\t\t\tnew HttpRequest(endpointUrl, configuration.batchBytesLimit),\n\t\t\tconfiguration.maxBatchSize,\n\t\t\tconfiguration.batchBytesLimit,\n\t\t\tconfiguration.maxMessageSize,\n\t\t\tconfiguration.flushTimeout,\n\t\t\tlifeCycle,\n\t\t)\n\t}\n\n\tvar stopped = false\n\treturn {\n\t\tadd: function (message) {\n\t\t\tif (stopped) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tprimaryBatch.add(message)\n\t\t},\n\t\tstop: function () {\n\t\t\tstopped = true\n\t\t},\n\t\tupsert: function (message, key) {\n\t\t\tif (stopped) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tprimaryBatch.upsert(message, key)\n\t\t},\n\t}\n}\n","import { noop } from '../helper/utils'\nimport { RumEventType } from '../helper/enums'\nimport { LifeCycleEventType } from '../core/lifeCycle'\n\nexport function trackEventCounts(lifeCycle, callback) {\n\tif (typeof callback === 'undefined') {\n\t\tcallback = noop\n\t}\n\tvar eventCounts = {\n\t\terrorCount: 0,\n\t\tresourceCount: 0,\n\t\tlongTaskCount: 0,\n\t\tuserActionCount: 0,\n\t}\n\n\tvar subscription = lifeCycle.subscribe(\n\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\tfunction (data) {\n\t\t\tvar rawRumEvent = data.rawRumEvent\n\t\t\tswitch (rawRumEvent.type) {\n\t\t\t\tcase RumEventType.ERROR:\n\t\t\t\t\teventCounts.errorCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t\tcase RumEventType.RESOURCE:\n\t\t\t\t\teventCounts.resourceCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t\tcase RumEventType.ACTION:\n\t\t\t\t\teventCounts.userActionCount += 1\n\t\t\t\t\tcallback(eventCounts)\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t},\n\t)\n\n\treturn {\n\t\tstop: function () {\n\t\t\tsubscription.unsubscribe()\n\t\t},\n\t\teventCounts: eventCounts,\n\t}\n}\n","import { extend, now, throttle, UUID, isNumber } from '../../helper/utils'\nimport { trackEventCounts } from '../trackEventCounts'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n// 劫持原小程序App方法\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\n\nexport function rewritePage(configuration, lifeCycle) {\n\tconst originPage = Page\n\tconsole.log(originPage, 'originPage=====')\n\tPage = function (page) {\n\t\t// 合并方法，插入记录脚本\n\t\tvar currentView,\n\t\t\tstartTime = now()\n\t\t;['onReady', 'onShow', 'onLoad', 'onUnload', 'onHide'].forEach(\n\t\t\t(methodName) => {\n\t\t\t\tconst userDefinedMethod = page[methodName]\n\t\t\t\tpage[methodName] = function () {\n\t\t\t\t\tconsole.log(methodName, 'methodName page')\n\t\t\t\t\tif (methodName === 'onShow' || methodName === 'onLoad') {\n\t\t\t\t\t\tif (typeof currentView === 'undefined') {\n\t\t\t\t\t\t\tconst activePage = getActivePage()\n\t\t\t\t\t\t\tcurrentView = newView(\n\t\t\t\t\t\t\t\tlifeCycle,\n\t\t\t\t\t\t\t\tactivePage && activePage.route,\n\t\t\t\t\t\t\t\tstartTime,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentView && currentView.setLoadEventEnd(methodName)\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(methodName === 'onUnload' ||\n\t\t\t\t\t\t\tmethodName === 'onHide' ||\n\t\t\t\t\t\t\tmethodName === 'onShow') &&\n\t\t\t\t\t\tcurrentView\n\t\t\t\t\t) {\n\t\t\t\t\t\tcurrentView.triggerUpdate()\n\t\t\t\t\t\tif (methodName === 'onUnload' || methodName === 'onHide') {\n\t\t\t\t\t\t\tcurrentView.end()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn userDefinedMethod && userDefinedMethod.apply(this, arguments)\n\t\t\t\t}\n\t\t\t},\n\t\t)\n\t\treturn originPage(page)\n\t}\n}\nfunction newView(lifeCycle, route, startTime) {\n\tif (typeof startTime === 'undefined') {\n\t\tstartTime = now()\n\t}\n\tvar id = UUID()\n\tvar isActive = true\n\tvar eventCounts = {\n\t\terrorCount: 0,\n\t\tresourceCount: 0,\n\t\tuserActionCount: 0,\n\t}\n\tvar setdataCount = 0\n\n\tvar documentVersion = 0\n\tvar setdataDuration = 0\n\tvar loadingDuration = 0\n\tvar loadingTime\n\tvar showTime\n\tvar onload2onshowTime\n\tvar onshow2onready\n\tvar stayTime\n\tvar fpt, fmp\n\tlifeCycle.notify(LifeCycleEventType.VIEW_CREATED, {\n\t\tid,\n\t\tstartTime,\n\t\troute,\n\t})\n\tvar scheduleViewUpdate = throttle(\n\t\ttriggerViewUpdate,\n\t\tTHROTTLE_VIEW_UPDATE_PERIOD,\n\t\t{\n\t\t\tleading: false,\n\t\t},\n\t)\n\tvar cancelScheduleViewUpdate = scheduleViewUpdate.cancel\n\tvar _trackEventCounts = trackEventCounts(\n\t\tlifeCycle,\n\t\tfunction (newEventCounts) {\n\t\t\teventCounts = newEventCounts\n\t\t\tscheduleViewUpdate()\n\t\t},\n\t)\n\tvar stopEventCountsTracking = _trackEventCounts.stop\n\tvar _trackFptTime = trackFptTime(lifeCycle, function (duration) {\n\t\tfpt = duration\n\t\tscheduleViewUpdate()\n\t})\n\tvar stopFptTracking = _trackFptTime.stop\n\tvar _trackSetDataTime = trackSetDataTime(lifeCycle, function (duration) {\n\t\tif (isNumber(duration)) {\n\t\t\tsetdataDuration += duration\n\t\t\tsetdataCount++\n\t\t\tscheduleViewUpdate()\n\t\t}\n\t})\n\tvar stopSetDataTracking = _trackSetDataTime.stop\n\tvar _trackLoadingTime = trackLoadingTime(lifeCycle, function (duration) {\n\t\tif (isNumber(duration)) {\n\t\t\tloadingDuration = duration\n\t\t\tscheduleViewUpdate()\n\t\t}\n\t})\n\tvar stopLoadingTimeTracking = _trackLoadingTime.stop\n\n\tvar setLoadEventEnd = function (type) {\n\t\tif (type === 'onLoad') {\n\t\t\tloadingTime = now()\n\t\t} else if (type === 'onShow') {\n\t\t\tshowTime = now()\n\t\t\tif (\n\t\t\t\ttypeof onload2onshowTime === 'undefined' &&\n\t\t\t\ttypeof loadingTime !== 'undefined'\n\t\t\t) {\n\t\t\t\tonload2onshowTime = showTime - loadingTime\n\t\t\t}\n\t\t} else if (type === 'onReady') {\n\t\t\tif (\n\t\t\t\ttypeof onshow2onready === 'undefined' &&\n\t\t\t\ttypeof showTime !== 'undefined'\n\t\t\t) {\n\t\t\t\tonshow2onready = now() - showTime\n\t\t\t}\n\t\t\tif (typeof fmp === 'undefined') {\n\t\t\t\tfmp = now() - startTime // 从开发者角度看，小程序首屏渲染完成的标志是首页 Page.onReady 事件触发。\n\t\t\t}\n\t\t} else if (type === 'onHide' || type === 'onUnload') {\n\t\t\tif (typeof showTime !== 'undefined') {\n\t\t\t\tstayTime = now() - showTime\n\t\t\t}\n\t\t\tisActive = false\n\t\t}\n\t\ttriggerViewUpdate()\n\t}\n\tfunction triggerViewUpdate() {\n\t\tdocumentVersion += 1\n\t\tlifeCycle.notify(LifeCycleEventType.VIEW_UPDATED, {\n\t\t\tdocumentVersion: documentVersion,\n\t\t\teventCounts: eventCounts,\n\t\t\tid: id,\n\t\t\tloadingTime: loadingDuration,\n\t\t\tstayTime,\n\t\t\tonload2onshowTime,\n\t\t\tonshow2onready,\n\t\t\tsetdataDuration,\n\t\t\tsetdataCount,\n\t\t\tfmp,\n\t\t\tfpt,\n\t\t\tstartTime: startTime,\n\t\t\troute: route,\n\t\t\tduration: now() - startTime,\n\t\t\tisActive: isActive,\n\t\t})\n\t}\n\treturn {\n\t\tscheduleUpdate: scheduleViewUpdate,\n\t\tsetLoadEventEnd,\n\t\ttriggerUpdate: function () {\n\t\t\tcancelScheduleViewUpdate()\n\t\t\ttriggerViewUpdate()\n\t\t},\n\t\tend: function () {\n\t\t\tstopEventCountsTracking()\n\t\t\tstopFptTracking()\n\t\t\tcancelScheduleViewUpdate()\n\t\t\tstopSetDataTracking()\n\t\t\tstopLoadingTimeTracking()\n\t\t\tlifeCycle.notify(LifeCycleEventType.VIEW_ENDED, { endClocks: now() })\n\t\t},\n\t}\n}\nfunction trackFptTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\tconst firstRenderEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'render' && entity.name === 'firstRender',\n\t\t\t)\n\n\t\t\tif (typeof firstRenderEntity !== 'undefined') {\n\t\t\t\tcallback(firstRenderEntity.duration)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction trackLoadingTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\tconst navigationEnity = entitys.find(\n\t\t\t\t(entity) => entity.entryType === 'navigation',\n\t\t\t)\n\t\t\tif (typeof navigationEnity !== 'undefined') {\n\t\t\t\tcallback(navigationEnity.duration)\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction trackSetDataTime(lifeCycle, callback) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PAGE_SET_DATA_UPDATE,\n\t\tfunction (data) {\n\t\t\tif (!data) return\n\t\t\tcallback(data.updateEndTimestamp - data.pendingStartTimestamp)\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\nfunction getActivePage() {\n\tconst curPages = getCurrentPages()\n\tif (curPages.length) {\n\t\treturn curPages[curPages.length - 1]\n\t}\n\treturn {}\n}\n","import { rewritePage } from './index'\nimport { RumEventType } from '../../helper/enums'\nimport { msToNs } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nexport function startViewCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_UPDATED, function (view) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessViewUpdate(view),\n\t\t)\n\t})\n\n\treturn rewritePage(configuration, lifeCycle)\n}\nfunction processViewUpdate(view) {\n\tvar apdexLevel\n\tif (view.fmp) {\n\t\tapdexLevel = parseInt(Number(view.fmp) / 1000)\n\t\tapdexLevel = apdexLevel > 9 ? 9 : apdexLevel\n\t}\n\tvar viewEvent = {\n\t\t_dd: {\n\t\t\tdocumentVersion: view.documentVersion,\n\t\t},\n\t\tdate: view.startTime,\n\t\ttype: RumEventType.VIEW,\n\t\tpage: {\n\t\t\taction: {\n\t\t\t\tcount: view.eventCounts.userActionCount,\n\t\t\t},\n\t\t\terror: {\n\t\t\t\tcount: view.eventCounts.errorCount,\n\t\t\t},\n\t\t\tsetdata: {\n\t\t\t\tcount: view.setdataCount,\n\t\t\t},\n\t\t\tsetdata_duration: msToNs(view.setdataDuration),\n\t\t\tloadingTime: msToNs(view.loadingTime),\n\t\t\tstayTime: msToNs(view.stayTime),\n\t\t\tonload2onshow: msToNs(view.onload2onshowTime),\n\t\t\tonshow2onready: msToNs(view.onshow2onready),\n\t\t\tfpt: msToNs(view.fpt),\n\t\t\tfmp: msToNs(view.fmp),\n\t\t\tisActive: view.isActive,\n\t\t\tapdexLevel,\n\t\t\t// longTask: {\n\t\t\t//   count: view.eventCounts.longTaskCount\n\t\t\t// },\n\t\t\tresource: {\n\t\t\t\tcount: view.eventCounts.resourceCount,\n\t\t\t},\n\t\t\ttimeSpent: msToNs(view.duration),\n\t\t},\n\t}\n\treturn {\n\t\trawRumEvent: viewEvent,\n\t\tstartTime: view.startTime,\n\t}\n}\n","import { msToNs, toArray, extend } from '../../helper/utils'\nimport { isIntakeRequest } from '../../core/configuration'\n\nfunction areInOrder() {\n\tvar numbers = toArray(arguments)\n\tfor (var i = 1; i < numbers.length; i += 1) {\n\t\tif (numbers[i - 1] > numbers[i]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n\nexport function computePerformanceResourceDuration(entry) {\n\t// Safari duration is always 0 on timings blocked by cross origin policies.\n\tif (entry.startTime < entry.responseEnd) {\n\t\treturn msToNs(entry.responseEnd - entry.startTime)\n\t}\n}\n\n//  interface PerformanceResourceDetails {\n//   redirect?: PerformanceResourceDetailsElement\n//   dns?: PerformanceResourceDetailsElement\n//   connect?: PerformanceResourceDetailsElement\n//   ssl?: PerformanceResourceDetailsElement\n//   firstByte: PerformanceResourceDetailsElement\n//   download: PerformanceResourceDetailsElement\n//   fmp:\n// }\n// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\n//  navigationStart：当前浏览器窗口的前一个网页关闭，发生unload事件时的Unix毫秒时间戳。如果没有前一个网页，则等于fetchStart属性。\n\n// ·   unloadEventStart：如果前一个网页与当前网页属于同一个域名，则返回前一个网页的unload事件发生时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   unloadEventEnd：如果前一个网页与当前网页属于同一个域名，则返回前一个网页unload事件的回调函数结束时的Unix毫秒时间戳。如果没有前一个网页，或者之前的网页跳转不是在同一个域名内，则返回值为0。\n\n// ·   redirectStart：返回第一个HTTP跳转开始时的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   redirectEnd：返回最后一个HTTP跳转结束时（即跳转回应的最后一个字节接受完成时）的Unix毫秒时间戳。如果没有跳转，或者不是同一个域名内部的跳转，则返回值为0。\n\n// ·   fetchStart：返回浏览器准备使用HTTP请求读取文档时的Unix毫秒时间戳。该事件在网页查询本地缓存之前发生。\n\n// ·   domainLookupStart：返回域名查询开始时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   domainLookupEnd：返回域名查询结束时的Unix毫秒时间戳。如果使用持久连接，或者信息是从本地缓存获取的，则返回值等同于fetchStart属性的值。\n\n// ·   connectStart：返回HTTP请求开始向服务器发送时的Unix毫秒时间戳。如果使用持久连接（persistent connection），则返回值等同于fetchStart属性的值。\n\n// ·   connectEnd：返回浏览器与服务器之间的连接建立时的Unix毫秒时间戳。如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。\n\n// ·   secureConnectionStart：返回浏览器与服务器开始安全链接的握手时的Unix毫秒时间戳。如果当前网页不要求安全连接，则返回0。\n\n// ·   requestStart：返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的Unix毫秒时间戳。\n\n// ·   responseStart：返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的Unix毫秒时间戳。\n\n// ·   responseEnd：返回浏览器从服务器收到（或从本地缓存读取）最后一个字节时（如果在此之前HTTP连接已经关闭，则返回关闭时）的Unix毫秒时间戳。\n\n// ·   domLoading：返回当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domInteractive：返回当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventStart：返回当前网页DOMContentLoaded事件发生时（即DOM结构解析完毕、所有脚本开始运行时）的Unix毫秒时间戳。\n\n// ·   domContentLoadedEventEnd：返回当前网页所有需要执行的脚本执行完成时的Unix毫秒时间戳。\n\n// ·   domComplete：返回当前网页DOM结构生成时（即Document.readyState属性变为“complete”，以及相应的readystatechange事件发生时）的Unix毫秒时间戳。\n\n// ·   loadEventStart：返回当前网页load事件的回调函数开始时的Unix毫秒时间戳。如果该事件还没有发生，返回0。\n\n// ·   loadEventEnd：返回当前网页load事件的回调函数运行结束时的Unix毫秒时间戳。如果该事件还没有发生，返回0\nexport function computePerformanceResourceDetails(entry) {\n\tvar validEntry = toValidEntry(entry)\n\n\tif (!validEntry) {\n\t\treturn undefined\n\t}\n\n\tvar startTime = validEntry.startTime,\n\t\tfetchStart = validEntry.fetchStart,\n\t\tredirectStart = validEntry.redirectStart,\n\t\tredirectEnd = validEntry.redirectEnd,\n\t\tdomainLookupStart =\n\t\t\tvalidEntry.domainLookupStart || validEntry.domainLookUpStart,\n\t\tdomainLookupEnd = validEntry.domainLookupEnd || validEntry.domainLookUpEnd,\n\t\tconnectStart = validEntry.connectStart,\n\t\tSSLconnectionStart = validEntry.SSLconnectionStart,\n\t\tSSLconnectionEnd = validEntry.SSLconnectionEnd,\n\t\tconnectEnd = validEntry.connectEnd,\n\t\trequestStart = validEntry.requestStart,\n\t\tresponseStart = validEntry.responseStart,\n\t\tresponseEnd = validEntry.responseEnd\n\tvar details = {\n\t\tfirstbyte: formatTiming(startTime, domainLookupStart, responseStart),\n\t\ttrans: formatTiming(startTime, responseStart, responseEnd),\n\t\tttfb: formatTiming(startTime, requestStart, responseStart),\n\t}\n\t// Make sure a connection occurred\n\tif (connectEnd !== fetchStart) {\n\t\tdetails.tcp = formatTiming(startTime, connectStart, connectEnd)\n\n\t\t// Make sure a secure connection occurred\n\t\tif (areInOrder(connectStart, SSLconnectionStart, SSLconnectionEnd)) {\n\t\t\tdetails.ssl = formatTiming(\n\t\t\t\tstartTime,\n\t\t\t\tSSLconnectionStart,\n\t\t\t\tSSLconnectionEnd,\n\t\t\t)\n\t\t}\n\t}\n\n\t// Make sure a domain lookup occurred\n\tif (domainLookupEnd !== fetchStart) {\n\t\tdetails.dns = formatTiming(startTime, domainLookupStart, domainLookupEnd)\n\t}\n\n\tif (hasRedirection(entry)) {\n\t\tdetails.redirect = formatTiming(startTime, redirectStart, redirectEnd)\n\t}\n\n\treturn details\n}\n\nexport function toValidEntry(entry) {\n\t// Ensure timings are in the right order. On top of filtering out potential invalid\n\t// RumPerformanceResourceTiming, it will ignore entries from requests where timings cannot be\n\t// collected, for example cross origin requests without a \"Timing-Allow-Origin\" header allowing\n\t// it.\n\t// page_fmp\tfloat\t\t首屏时间(用于衡量用户什么时候看到页面的主要内容)，跟FCP的时长非常接近，这里我们就用FCP的时间作为首屏时间\tfirstPaintContentEnd - firstPaintContentStart\n\t// page_fpt\tfloat\t\t首次渲染时间，即白屏时间(从请求开始到浏览器开始解析第一批HTML文档字节的时间差。)\tresponseEnd - fetchStart\n\t// page_tti\tfloat\t\t首次可交互时间(浏览器完成所有HTML解析并且完成DOM构建，此时浏览器开始加载资源。)\tdomInteractive - fetchStart\n\t// page_firstbyte\tfloat\t\t首包时间\tresponseStart - domainLookupStart\n\t// page_dom_ready\tfloat\t\tDOM Ready时间(如果页面有同步执行的JS，则同步JS执行时间=ready-tti。)\tdomContentLoadEventEnd - fetchStart\n\t// page_load\tfloat\t\t页面完全加载时间(load=首次渲染时间+DOM解析耗时+同步JS执行+资源加载耗时。)\tloadEventStart - fetchStart\n\t// page_dns\tfloat\t\tdns解析时间\tdomainLookupEnd - domainLookupStart\n\t// page_tcp\tfloat\t\ttcp连接时间\tconnectEnd - connectStart\n\t// page_ssl\tfloat\t\tssl安全连接时间(仅适用于https)\tconnectEnd - secureConnectionStart\n\t// page_ttfb\tfloat\t\t请求响应耗时\tresponseStart - requestStart\n\t// page_trans\tfloat\t\t内容传输时间\tresponseEnd - responseStart\n\t// page_dom\tfloat\t\tDOM解析耗时\tdomInteractive - responseEnd\n\t// page_resource_load_time\tfloat\t\t资源加载时间\tloadEventStart - domContentLoadedEventEnd\n\tif (\n\t\t!areInOrder(\n\t\t\tentry.startTime,\n\t\t\tentry.fetchStart,\n\t\t\tentry.domainLookupStart,\n\t\t\tentry.domainLookupEnd,\n\t\t\tentry.connectStart,\n\t\t\tentry.connectEnd,\n\t\t\tentry.requestStart,\n\t\t\tentry.responseStart,\n\t\t\tentry.responseEnd,\n\t\t)\n\t) {\n\t\treturn undefined\n\t}\n\n\tif (!hasRedirection(entry)) {\n\t\treturn entry\n\t}\n\n\tvar redirectStart = entry.redirectStart\n\tvar redirectEnd = entry.redirectEnd\n\t// Firefox doesn't provide redirect timings on cross origin requests.\n\t// Provide a default for those.\n\tif (redirectStart < entry.startTime) {\n\t\tredirectStart = entry.startTime\n\t}\n\tif (redirectEnd < entry.startTime) {\n\t\tredirectEnd = entry.fetchStart\n\t}\n\n\t// Make sure redirect timings are in order\n\tif (\n\t\t!areInOrder(entry.startTime, redirectStart, redirectEnd, entry.fetchStart)\n\t) {\n\t\treturn undefined\n\t}\n\treturn extend({}, entry, {\n\t\tredirectEnd: redirectEnd,\n\t\tredirectStart: redirectStart,\n\t})\n\t// return {\n\t//   ...entry,\n\t//   redirectEnd,\n\t//   redirectStart\n\t// }\n}\n\nfunction hasRedirection(entry) {\n\t// The only time fetchStart is different than startTime is if a redirection occurred.\n\treturn entry.fetchStart !== entry.startTime\n}\n\nfunction formatTiming(origin, start, end) {\n\treturn msToNs(end - start)\n}\n\nexport function computeSize(entry) {\n\t// Make sure a request actually occurred\n\tif (entry.startTime < entry.responseStart) {\n\t\treturn entry.receivedBytedCount\n\t}\n\treturn undefined\n}\n\nexport function isAllowedRequestUrl(configuration, url) {\n\treturn url && !isIntakeRequest(url, configuration)\n}\n","import { startXhrProxy } from '../core/xhrProxy'\nimport { startDownloadProxy } from '../core/downloadProxy'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { isObject } from '../helper/utils'\nimport { isAllowedRequestUrl } from '../rumEventsCollection/resource/resourceUtils'\nvar nextRequestIndex = 1\n\nexport function startRequestCollection(lifeCycle, configuration) {\n\ttrackXhr(lifeCycle, configuration)\n\ttrackDownload(lifeCycle, configuration)\n}\nfunction parseHeader(header) {\n\t// 大小写兼容\n\tif (!isObject(header)) return header\n\tvar res = {}\n\tObject.keys(header).forEach(function (key) {\n\t\tres[key.toLowerCase()] = header[key]\n\t})\n\treturn res\n}\nfunction getHeaderString(header) {\n\tif (!isObject(header)) return header\n\tvar headerStr = ''\n\tObject.keys(header).forEach(function (key) {\n\t\theaderStr += key + ':' + header[key] + ';'\n\t})\n\treturn headerStr\n}\nexport function trackXhr(lifeCycle, configuration) {\n\tvar xhrProxy = startXhrProxy()\n\txhrProxy.beforeSend(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tcontext.requestIndex = getNextRequestIndex()\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_STARTED, {\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t})\n\t\t}\n\t})\n\txhrProxy.onRequestComplete(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_COMPLETED, {\n\t\t\t\tduration: context.duration,\n\t\t\t\tmethod: context.method,\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t\tperformance: context.profile,\n\t\t\t\tresponse: context.response,\n\t\t\t\tstartTime: context.startTime,\n\t\t\t\tstatus: context.status,\n\t\t\t\ttype: context.type,\n\t\t\t\turl: context.url,\n\t\t\t})\n\t\t}\n\t})\n\treturn xhrProxy\n}\nexport function trackDownload(lifeCycle, configuration) {\n\tvar dwonloadProxy = startDownloadProxy()\n\tdwonloadProxy.beforeSend(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tcontext.requestIndex = getNextRequestIndex()\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_STARTED, {\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t})\n\t\t}\n\t})\n\tdwonloadProxy.onRequestComplete(function (context) {\n\t\tif (isAllowedRequestUrl(configuration, context.url)) {\n\t\t\tlifeCycle.notify(LifeCycleEventType.REQUEST_COMPLETED, {\n\t\t\t\tduration: context.duration,\n\t\t\t\tmethod: context.method,\n\t\t\t\trequestIndex: context.requestIndex,\n\t\t\t\tperformance: context.profile,\n\t\t\t\tresponse: context.response,\n\t\t\t\tstartTime: context.startTime,\n\t\t\t\tstatus: context.status,\n\t\t\t\ttype: context.type,\n\t\t\t\turl: context.url,\n\t\t\t})\n\t\t}\n\t})\n\treturn dwonloadProxy\n}\nfunction getNextRequestIndex() {\n\tvar result = nextRequestIndex\n\tnextRequestIndex += 1\n\treturn result\n}\n","import {\n\tcomputePerformanceResourceDuration,\n\tcomputePerformanceResourceDetails,\n\tcomputeSize,\n} from './resourceUtils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport {\n\tmsToNs,\n\textend2Lev,\n\turlParse,\n\tgetQueryParamsFromUrl,\n\treplaceNumberCharByPath,\n\tjsonStringify,\n\tgetStatusGroup,\n} from '../../helper/utils'\nimport { RumEventType } from '../../helper/enums'\nexport function startResourceCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.REQUEST_COMPLETED, function (request) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessRequest(request),\n\t\t)\n\t})\n}\n\nfunction processRequest(request) {\n\tvar type = request.type\n\tvar timing = request.performance\n\tvar correspondingTimingOverrides = timing\n\t\t? computePerformanceEntryMetrics(timing)\n\t\t: undefined\n\tvar urlObj = urlParse(request.url).getParse()\n\tvar startTime = request.startTime\n\tvar resourceEvent = extend2Lev(\n\t\t{\n\t\t\tdate: startTime,\n\t\t\tresource: {\n\t\t\t\ttype: type,\n\t\t\t\tduration: msToNs(request.duration),\n\t\t\t\tmethod: request.method,\n\t\t\t\tstatus: request.status,\n\t\t\t\tstatusGroup: getStatusGroup(request.status),\n\t\t\t\turl: request.url,\n\t\t\t\turlHost: urlObj.Host,\n\t\t\t\turlPath: urlObj.Path,\n\t\t\t\turlPathGroup: replaceNumberCharByPath(urlObj.Path),\n\t\t\t\turlQuery: jsonStringify(getQueryParamsFromUrl(request.url)),\n\t\t\t},\n\t\t\ttype: RumEventType.RESOURCE,\n\t\t},\n\t\tcorrespondingTimingOverrides,\n\t)\n\treturn { startTime: startTime, rawRumEvent: resourceEvent }\n}\nfunction computePerformanceEntryMetrics(timing) {\n\treturn {\n\t\tresource: extend2Lev(\n\t\t\t{},\n\t\t\t{\n\t\t\t\tload: computePerformanceResourceDuration(timing),\n\t\t\t\tsize: computeSize(timing),\n\t\t\t},\n\t\t\tcomputePerformanceResourceDetails(timing),\n\t\t),\n\t}\n}\n","import { now, areInOrder, UUID } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\n\n// 劫持原小程序App方法\nexport var THROTTLE_VIEW_UPDATE_PERIOD = 3000\nexport const startupTypes = {\n\tCOLD: 'cold',\n\tHOT: 'hot',\n}\nexport function rewriteApp(configuration, lifeCycle) {\n\tconst originApp = App\n\tvar appInfo = {\n\t\tisStartUp: false, // 是否启动\n\t}\n\tvar startTime\n\tApp = function (app) {\n\t\tstartTime = now()\n\t\t// 合并方法，插入记录脚本\n\t\t;['onLaunch', 'onShow', 'onHide'].forEach((methodName) => {\n\t\t\tconst userDefinedMethod = app[methodName] // 暂存用户定义的方法\n\t\t\tapp[methodName] = function (options) {\n\t\t\t\tconsole.log(methodName, 'methodName app')\n\t\t\t\tif (methodName === 'onLaunch') {\n\t\t\t\t\tappInfo.isStartUp = true\n\t\t\t\t\tappInfo.isHide = false\n\t\t\t\t\tappInfo.startupType = startupTypes.COLD\n\t\t\t\t} else if (methodName === 'onShow') {\n\t\t\t\t\tif (appInfo.isStartUp && appInfo.isHide) {\n\t\t\t\t\t\t// 判断是热启动\n\t\t\t\t\t\tappInfo.startupType = startupTypes.HOT\n\t\t\t\t\t\t// appUpdate()\n\t\t\t\t\t}\n\t\t\t\t} else if (methodName === 'onHide') {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.APP_HIDE)\n\t\t\t\t\tappInfo.isHide = true\n\t\t\t\t}\n\t\t\t\treturn userDefinedMethod && userDefinedMethod.call(this, options)\n\t\t\t}\n\t\t})\n\t\treturn originApp(app)\n\t}\n\n\tstartPerformanceObservable(lifeCycle)\n}\n\nfunction startPerformanceObservable(lifeCycle) {\n\tvar subscribe = lifeCycle.subscribe(\n\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\tfunction (entitys) {\n\t\t\t// 过滤掉其他页面监听，只保留首次启动\n\t\t\tvar codeDownloadDuration\n\t\t\tconst launchEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'navigation' &&\n\t\t\t\t\tentity.navigationType === 'appLaunch',\n\t\t\t)\n\t\t\tif (typeof launchEntity !== 'undefined') {\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.APP_UPDATE, {\n\t\t\t\t\tstartTime: launchEntity.startTime,\n\t\t\t\t\tname: '启动',\n\t\t\t\t\ttype: 'launch',\n\t\t\t\t\tid: UUID(),\n\t\t\t\t\tduration: launchEntity.duration,\n\t\t\t\t})\n\t\t\t}\n\t\t\tconst scriptentity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'script' && entity.name === 'evaluateScript',\n\t\t\t)\n\t\t\tif (typeof scriptentity !== 'undefined') {\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.APP_UPDATE, {\n\t\t\t\t\tstartTime: scriptentity.startTime,\n\t\t\t\t\tname: '脚本注入',\n\t\t\t\t\ttype: 'script_insert',\n\t\t\t\t\tid: UUID(),\n\t\t\t\t\tduration: scriptentity.duration,\n\t\t\t\t})\n\t\t\t}\n\t\t\tconst firstEntity = entitys.find(\n\t\t\t\t(entity) =>\n\t\t\t\t\tentity.entryType === 'render' && entity.name === 'firstRender',\n\t\t\t)\n\t\t\tif (firstEntity && scriptentity && launchEntity) {\n\t\t\t\tif (\n\t\t\t\t\t!areInOrder(firstEntity.duration, launchEntity.duration) ||\n\t\t\t\t\t!areInOrder(scriptentity.duration, launchEntity.duration)\n\t\t\t\t) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tcodeDownloadDuration =\n\t\t\t\t\tlaunchEntity.duration - firstEntity.duration - scriptentity.duration\n\t\t\t\t// 资源下载耗时\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.APP_UPDATE, {\n\t\t\t\t\tstartTime: launchEntity.startTime,\n\t\t\t\t\tname: '小程序包下载',\n\t\t\t\t\ttype: 'package_download',\n\t\t\t\t\tid: UUID(),\n\t\t\t\t\tduration: codeDownloadDuration,\n\t\t\t\t})\n\t\t\t\t// 资源下载时间暂时定为：首次启动时间-脚本加载时间-初次渲染时间\n\t\t\t}\n\t\t},\n\t)\n\treturn {\n\t\tstop: subscribe.unsubscribe,\n\t}\n}\n","import { rewriteApp } from './index'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { RumEventType } from '../../helper/enums'\nimport { msToNs } from '../../helper/utils'\nexport function startAppCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(LifeCycleEventType.APP_UPDATE, function (appinfo) {\n\t\tlifeCycle.notify(\n\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\tprocessAppUpdate(appinfo),\n\t\t)\n\t})\n\n\treturn rewriteApp(configuration, lifeCycle)\n}\n\nfunction processAppUpdate(appinfo) {\n\tvar appEvent = {\n\t\tdate: appinfo.startTime,\n\t\ttype: RumEventType.APP,\n\t\tapp: {\n\t\t\ttype: appinfo.type,\n\t\t\tname: appinfo.name,\n\t\t\tid: appinfo.id,\n\t\t\tduration: msToNs(appinfo.duration),\n\t\t},\n\t}\n\tconsole.log(appEvent, 'appEvent====')\n\treturn {\n\t\trawRumEvent: appEvent,\n\t\tstartTime: appinfo.startTime,\n\t}\n}\n","import { each, now } from '../helper/utils'\nimport { LifeCycleEventType } from '../core/lifeCycle'\nimport { Observable } from '../core/observable'\n// Delay to wait for a page activity to validate the tracking process\nexport var PAGE_ACTIVITY_VALIDATION_DELAY = 100\n// Delay to wait after a page activity to end the tracking process\nexport var PAGE_ACTIVITY_END_DELAY = 100\n// Maximum duration of the tracking process\nexport var PAGE_ACTIVITY_MAX_DURATION = 10000\n\nexport function waitIdlePageActivity(lifeCycle, completionCallback) {\n\tvar _trackPageActivities = trackPageActivities(lifeCycle)\n\tvar pageActivitiesObservable = _trackPageActivities.observable\n\tvar stopPageActivitiesTracking = _trackPageActivities.stop\n\tvar _waitPageActivitiesCompletion = waitPageActivitiesCompletion(\n\t\tpageActivitiesObservable,\n\t\tstopPageActivitiesTracking,\n\t\tcompletionCallback,\n\t)\n\n\tvar stopWaitPageActivitiesCompletion = _waitPageActivitiesCompletion.stop\n\tfunction stop() {\n\t\tstopWaitPageActivitiesCompletion()\n\t\tstopPageActivitiesTracking()\n\t}\n\n\treturn { stop: stop }\n}\n\n// Automatic action collection lifecycle overview:\n//                      (Start new trackPageActivities)\n//              .-------------------'--------------------.\n//              v                                        v\n//     [Wait for a page activity ]          [Wait for a maximum duration]\n//     [timeout: VALIDATION_DELAY]          [  timeout: MAX_DURATION    ]\n//          /                  \\                           |\n//         v                    v                          |\n//  [No page activity]   [Page activity]                   |\n//         |                   |,----------------------.   |\n//         v                   v                       |   |\n//     (Discard)     [Wait for a page activity]        |   |\n//                   [   timeout: END_DELAY   ]        |   |\n//                       /                \\            |   |\n//                      v                  v           |   |\n//             [No page activity]    [Page activity]   |   |\n//                      |                 |            |   |\n//                      |                 '------------'   |\n//                      '-----------. ,--------------------'\n//                                   v\n//                                 (End)\n//\n// Note: because MAX_DURATION > VALIDATION_DELAY, we are sure that if the process is still alive\n// after MAX_DURATION, it has been validated.\nexport function trackPageActivities(lifeCycle) {\n\tvar observable = new Observable()\n\tvar subscriptions = []\n\tvar firstRequestIndex\n\tvar pendingRequestsCount = 0\n\n\tsubscriptions.push(\n\t\tlifeCycle.subscribe(LifeCycleEventType.PAGE_SET_DATA_UPDATE, function () {\n\t\t\tnotifyPageActivity()\n\t\t}),\n\t\tlifeCycle.subscribe(LifeCycleEventType.PAGE_ALIAS_ACTION, function () {\n\t\t\tnotifyPageActivity()\n\t\t}),\n\t)\n\n\tsubscriptions.push(\n\t\tlifeCycle.subscribe(\n\t\t\tLifeCycleEventType.REQUEST_STARTED,\n\t\t\tfunction (startEvent) {\n\t\t\t\tif (firstRequestIndex === undefined) {\n\t\t\t\t\tfirstRequestIndex = startEvent.requestIndex\n\t\t\t\t}\n\n\t\t\t\tpendingRequestsCount += 1\n\t\t\t\tnotifyPageActivity()\n\t\t\t},\n\t\t),\n\t)\n\n\tsubscriptions.push(\n\t\tlifeCycle.subscribe(\n\t\t\tLifeCycleEventType.REQUEST_COMPLETED,\n\t\t\tfunction (request) {\n\t\t\t\t// If the request started before the tracking start, ignore it\n\t\t\t\tif (\n\t\t\t\t\tfirstRequestIndex === undefined ||\n\t\t\t\t\trequest.requestIndex < firstRequestIndex\n\t\t\t\t) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tpendingRequestsCount -= 1\n\t\t\t\tnotifyPageActivity()\n\t\t\t},\n\t\t),\n\t)\n\n\tfunction notifyPageActivity() {\n\t\tobservable.notify({ isBusy: pendingRequestsCount > 0 })\n\t}\n\n\treturn {\n\t\tobservable: observable,\n\t\tstop: function () {\n\t\t\teach(subscriptions, function (sub) {\n\t\t\t\tsub.unsubscribe()\n\t\t\t})\n\t\t},\n\t}\n}\n\nexport function waitPageActivitiesCompletion(\n\tpageActivitiesObservable,\n\tstopPageActivitiesTracking,\n\tcompletionCallback,\n) {\n\tvar idleTimeoutId\n\tvar hasCompleted = false\n\n\tvar validationTimeoutId = setTimeout(function () {\n\t\tcomplete({ hadActivity: false })\n\t}, PAGE_ACTIVITY_VALIDATION_DELAY)\n\tvar maxDurationTimeoutId = setTimeout(function () {\n\t\tcomplete({ hadActivity: true, endTime: now() })\n\t}, PAGE_ACTIVITY_MAX_DURATION)\n\tpageActivitiesObservable.subscribe(function (data) {\n\t\tvar isBusy = data.isBusy\n\t\tclearTimeout(validationTimeoutId)\n\t\tclearTimeout(idleTimeoutId)\n\t\tvar lastChangeTime = now()\n\t\tif (!isBusy) {\n\t\t\tidleTimeoutId = setTimeout(function () {\n\t\t\t\tcomplete({ hadActivity: true, endTime: lastChangeTime })\n\t\t\t}, PAGE_ACTIVITY_END_DELAY)\n\t\t}\n\t})\n\n\tfunction stop() {\n\t\thasCompleted = true\n\t\tclearTimeout(validationTimeoutId)\n\t\tclearTimeout(idleTimeoutId)\n\t\tclearTimeout(maxDurationTimeoutId)\n\t\tstopPageActivitiesTracking()\n\t}\n\n\tfunction complete(params) {\n\t\tif (hasCompleted) {\n\t\t\treturn\n\t\t}\n\t\tstop()\n\t\tcompletionCallback(params)\n\t}\n\n\treturn { stop: stop }\n}\n","import { elapsed, now, UUID, getMethods, isObject } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { MinaTouch } from '../../core/miniaTouch'\nimport { trackEventCounts } from '../trackEventCounts'\nimport { waitIdlePageActivity } from '../trackPageActiveites'\nimport { ActionType } from '../../helper/enums'\nexport function trackActions(lifeCycle) {\n\tvar action = startActionManagement(lifeCycle)\n\n\t// New views trigger the discard of the current pending Action\n\tlifeCycle.subscribe(LifeCycleEventType.VIEW_CREATED, function () {\n\t\taction.discardCurrent()\n\t})\n\tvar originPage = Page\n\tPage = function (page) {\n\t\tconst methods = getMethods(page)\n\t\tmethods.forEach((methodName) => {\n\t\t\tclickProxy(\n\t\t\t\tpage,\n\t\t\t\tmethodName,\n\t\t\t\tfunction (_action) {\n\t\t\t\t\taction.create(_action.type, _action.name)\n\t\t\t\t},\n\t\t\t\tlifeCycle,\n\t\t\t)\n\t\t})\n\t\treturn originPage(page)\n\t}\n\tvar originComponent = Component\n\tComponent = function (component) {\n\t\tconst methods = getMethods(component)\n\t\tmethods.forEach((methodName) => {\n\t\t\tclickProxy(component, methodName, function (_action) {\n\t\t\t\taction.create(_action.type, _action.name)\n\t\t\t})\n\t\t})\n\t\treturn originComponent(component)\n\t}\n\treturn {\n\t\tstop: function () {\n\t\t\taction.discardCurrent()\n\t\t\t// stopListener()\n\t\t},\n\t}\n}\nfunction clickProxy(page, methodName, callback, lifeCycle) {\n\tvar oirginMethod = page[methodName]\n\n\tpage[methodName] = function () {\n\t\tconst result = oirginMethod.apply(this, arguments)\n\t\tvar action = {}\n\t\tif (isObject(arguments[0])) {\n\t\t\tvar currentTarget = arguments[0].currentTarget || {}\n\t\t\tvar dataset = currentTarget.dataset || {}\n\t\t\tvar actionType = arguments[0].type\n\t\t\tif (actionType && ActionType[actionType]) {\n\t\t\t\taction.type = actionType\n\t\t\t\taction.name = dataset.name || dataset.content || dataset.type\n\t\t\t\tcallback(action)\n\t\t\t} else if (methodName === 'onAddToFavorites') {\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'收藏 ' +\n\t\t\t\t\t'标题: ' +\n\t\t\t\t\tresult.title +\n\t\t\t\t\t(result.query ? ' query: ' + result.query : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t} else if (methodName === 'onShareAppMessage') {\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'转发 ' +\n\t\t\t\t\t'标题: ' +\n\t\t\t\t\tresult.title +\n\t\t\t\t\t(result.path ? ' path: ' + result.path : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t} else if (methodName === 'onShareTimeline') {\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'分享到朋友圈 ' +\n\t\t\t\t\t'标题: ' +\n\t\t\t\t\tresult.title +\n\t\t\t\t\t(result.query ? ' query: ' + result.query : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t} else if (methodName === 'onTabItemTap') {\n\t\t\t\tvar item = arguments.length && arguments[0]\n\t\t\t\taction.type = 'click'\n\t\t\t\taction.name =\n\t\t\t\t\t'tab ' +\n\t\t\t\t\t'名称: ' +\n\t\t\t\t\titem.text +\n\t\t\t\t\t(item.pagePath ? ' 跳转到: ' + item.pagePath : '')\n\t\t\t\tcallback(action)\n\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_ALIAS_ACTION, true)\n\t\t\t}\n\t\t}\n\t\treturn result\n\t}\n}\nfunction startActionManagement(lifeCycle) {\n\tvar currentAction\n\tvar currentIdlePageActivitySubscription\n\n\treturn {\n\t\tcreate: function (type, name) {\n\t\t\tif (currentAction) {\n\t\t\t\t// Ignore any new action if another one is already occurring.\n\t\t\t\treturn\n\t\t\t}\n\t\t\tvar pendingAutoAction = new PendingAutoAction(lifeCycle, type, name)\n\n\t\t\tcurrentAction = pendingAutoAction\n\t\t\tcurrentIdlePageActivitySubscription = waitIdlePageActivity(\n\t\t\t\tlifeCycle,\n\t\t\t\tfunction (params) {\n\t\t\t\t\tif (params.hadActivity) {\n\t\t\t\t\t\tpendingAutoAction.complete(params.endTime)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpendingAutoAction.discard()\n\t\t\t\t\t}\n\t\t\t\t\tcurrentAction = undefined\n\t\t\t\t},\n\t\t\t)\n\t\t},\n\t\tdiscardCurrent: function () {\n\t\t\tif (currentAction) {\n\t\t\t\tcurrentIdlePageActivitySubscription.stop()\n\t\t\t\tcurrentAction.discard()\n\t\t\t\tcurrentAction = undefined\n\t\t\t}\n\t\t},\n\t}\n}\nvar PendingAutoAction = function (lifeCycle, type, name) {\n\tthis.id = UUID()\n\tthis.startClocks = now()\n\tthis.name = name\n\tthis.type = type\n\tthis.lifeCycle = lifeCycle\n\tthis.eventCountsSubscription = trackEventCounts(lifeCycle)\n\tthis.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_CREATED, {\n\t\tid: this.id,\n\t\tstartClocks: this.startClocks,\n\t})\n}\nPendingAutoAction.prototype = {\n\tcomplete: function (endTime) {\n\t\tvar eventCounts = this.eventCountsSubscription.eventCounts\n\t\tthis.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_COMPLETED, {\n\t\t\tcounts: {\n\t\t\t\terrorCount: eventCounts.errorCount,\n\t\t\t\tlongTaskCount: eventCounts.longTaskCount,\n\t\t\t\tresourceCount: eventCounts.resourceCount,\n\t\t\t},\n\t\t\tduration: elapsed(this.startClocks, endTime),\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tstartClocks: this.startClocks,\n\t\t\ttype: this.type,\n\t\t})\n\t\tthis.eventCountsSubscription.stop()\n\t},\n\tdiscard: function () {\n\t\tthis.lifeCycle.notify(LifeCycleEventType.AUTO_ACTION_DISCARDED)\n\t\tthis.eventCountsSubscription.stop()\n\t},\n}\n","import { msToNs, extend2Lev } from '../../helper/utils'\nimport { LifeCycleEventType } from '../../core/lifeCycle'\nimport { RumEventType } from '../../helper/enums'\nimport { trackActions } from './trackActions'\n\nexport function startActionCollection(lifeCycle, configuration) {\n\tlifeCycle.subscribe(\n\t\tLifeCycleEventType.AUTO_ACTION_COMPLETED,\n\t\tfunction (action) {\n\t\t\tlifeCycle.notify(\n\t\t\t\tLifeCycleEventType.RAW_RUM_EVENT_COLLECTED,\n\t\t\t\tprocessAction(action),\n\t\t\t)\n\t\t},\n\t)\n\tif (configuration.trackInteractions) {\n\t\ttrackActions(lifeCycle)\n\t}\n}\n\nfunction processAction(action) {\n\tvar autoActionProperties = {\n\t\taction: {\n\t\t\terror: {\n\t\t\t\tcount: action.counts.errorCount,\n\t\t\t},\n\t\t\tid: action.id,\n\t\t\tloadingTime: msToNs(action.duration),\n\t\t\tlong_task: {\n\t\t\t\tcount: action.counts.longTaskCount,\n\t\t\t},\n\t\t\tresource: {\n\t\t\t\tcount: action.counts.resourceCount,\n\t\t\t},\n\t\t},\n\t}\n\tvar actionEvent = extend2Lev(\n\t\t{\n\t\t\taction: {\n\t\t\t\ttarget: {\n\t\t\t\t\tname: action.name,\n\t\t\t\t},\n\t\t\t\ttype: action.type,\n\t\t\t},\n\t\t\tdate: action.startClocks,\n\t\t\ttype: RumEventType.ACTION,\n\t\t},\n\t\tautoActionProperties,\n\t)\n\treturn {\n\t\trawRumEvent: actionEvent,\n\t\tstartTime: action.startClocks,\n\t}\n}\n","import { buildEnv } from './buildEnv'\nimport { LifeCycle } from '../core/lifeCycle'\nimport { commonInit } from '../core/configuration'\nimport { startErrorCollection } from '../rumEventsCollection/error/errorCollection'\nimport { startRumAssembly } from '../rumEventsCollection/assembly'\nimport { startParentContexts } from '../rumEventsCollection/parentContexts'\nimport { startRumBatch } from '../rumEventsCollection/transport/batch'\nimport { startViewCollection } from '../rumEventsCollection/page/viewCollection'\nimport { startRequestCollection } from '../rumEventsCollection/requestCollection'\nimport { startResourceCollection } from '../rumEventsCollection/resource/resourceCollection'\nimport { startAppCollection } from '../rumEventsCollection/app/appCollection'\nimport { startPagePerformanceObservable } from '../rumEventsCollection/performanceCollection'\nimport { startSetDataColloction } from '../rumEventsCollection/setDataCollection'\nimport { startActionCollection } from '../rumEventsCollection/action/actionCollection'\n\nimport { sdk } from '../core/sdk'\nexport const startRum = function (userConfiguration) {\n\tconst configuration = commonInit(userConfiguration, buildEnv)\n\tconst lifeCycle = new LifeCycle()\n\tvar parentContexts = startParentContexts(lifeCycle)\n\tvar batch = startRumBatch(configuration, lifeCycle)\n\tstartRumAssembly(\n\t\tuserConfiguration.applicationId,\n\t\tconfiguration,\n\t\tlifeCycle,\n\t\tparentContexts,\n\t)\n\tstartAppCollection(lifeCycle, configuration)\n\tstartResourceCollection(lifeCycle, configuration)\n\tstartViewCollection(lifeCycle, configuration)\n\tstartErrorCollection(lifeCycle, configuration)\n\tstartRequestCollection(lifeCycle, configuration)\n\tstartPagePerformanceObservable(lifeCycle, configuration)\n\tstartSetDataColloction(lifeCycle)\n\tstartActionCollection(lifeCycle, configuration)\n}\n","import { isPercentage } from '../helper/utils'\nimport { startRum } from './rum'\nexport const makeRum = function (startRumImpl) {\n\tvar isAlreadyInitialized = false\n\tvar rumGlobal = {\n\t\tinit: function (userConfiguration) {\n\t\t\tif (typeof userConfiguration === 'undefined') {\n\t\t\t\tuserConfiguration = {}\n\t\t\t}\n\t\t\tif (!canInitRum(userConfiguration)) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tstartRumImpl(userConfiguration)\n\n\t\t\tisAlreadyInitialized = true\n\t\t},\n\t}\n\treturn rumGlobal\n\tfunction canInitRum(userConfiguration) {\n\t\tif (isAlreadyInitialized) {\n\t\t\tconsole.error('DATAFLUX_RUM is already initialized.')\n\t\t\treturn false\n\t\t}\n\n\t\tif (!userConfiguration.applicationId) {\n\t\t\tconsole.error(\n\t\t\t\t'Application ID is not configured, no RUM data will be collected.',\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t\tif (!userConfiguration.datakitOrigin) {\n\t\t\tconsole.error(\n\t\t\t\t'datakitOrigin is not configured, no RUM data will be collected.',\n\t\t\t)\n\t\t\treturn false\n\t\t}\n\t\tif (\n\t\t\tuserConfiguration.sampleRate !== undefined &&\n\t\t\t!isPercentage(userConfiguration.sampleRate)\n\t\t) {\n\t\t\tconsole.error('Sample Rate should be a number between 0 and 100')\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t}\n}\nexport const datafluxRum = makeRum(startRum)\n","import { LifeCycleEventType } from '../core/lifeCycle'\nimport { sdk } from '../core/sdk'\nexport function startPagePerformanceObservable(lifeCycle, configuration) {\n\tif (!!sdk.getPerformance) {\n\t\tconst performance = sdk.getPerformance()\n\t\tconst observer = performance.createObserver((entryList) => {\n\t\t\tlifeCycle.notify(\n\t\t\t\tLifeCycleEventType.PERFORMANCE_ENTRY_COLLECTED,\n\t\t\t\tentryList.getEntries(),\n\t\t\t)\n\t\t})\n\t\tobserver.observe({ entryTypes: ['render', 'script', 'navigation'] })\n\t}\n}\n","import { LifeCycleEventType } from '../core/lifeCycle'\n\nexport function startSetDataColloction(lifeCycle) {\n\tconst originPage = Page\n\tconst originComponent = Component\n\tPage = function (page) {\n\t\tconst originPageOnLoad = page['onLoad']\n\t\tpage['onLoad'] = function () {\n\t\t\tthis.setUpdatePerformanceListener &&\n\t\t\t\tthis.setUpdatePerformanceListener({ withDataPaths: true }, (res) => {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_SET_DATA_UPDATE, res)\n\t\t\t\t})\n\t\t\treturn originPageOnLoad.apply(this, arguments)\n\t\t}\n\t\treturn originPage(page)\n\t}\n\tComponent = function (component) {\n\t\tconst originComponentAttached = component['attached']\n\t\tcomponent['attached'] = function () {\n\t\t\tthis.setUpdatePerformanceListener &&\n\t\t\t\tthis.setUpdatePerformanceListener({ withDataPaths: true }, (res) => {\n\t\t\t\t\tlifeCycle.notify(LifeCycleEventType.PAGE_SET_DATA_UPDATE, res)\n\t\t\t\t})\n\t\t\treturn originComponentAttached.apply(this, arguments)\n\t\t}\n\t\treturn originComponent(component)\n\t}\n}\n"],"sourceRoot":""}